<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Journal on Software]]></title><description><![CDATA[Journal on Software]]></description><link>http://github.com/dylang/node-rss</link><generator>RSS for Node</generator><lastBuildDate>Sun, 04 Aug 2019 06:52:41 GMT</lastBuildDate><item><title><![CDATA[Web security unknowns: Same-origin Policy]]></title><description><![CDATA[Attacks like CSRF or XSS are still not clear to many of us. It is not because they are super hard to understand, but it requires some basic understanding of concepts like SOP, CORS, CSP, HTTPS. Let's start with what's Same-origin Policy]]></description><link>https://merictaze.com/posts/web-security-unknowns-same-origin-policy/</link><guid isPermaLink="false">https://merictaze.com/posts/web-security-unknowns-same-origin-policy/</guid><pubDate>Tue, 16 Jul 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Attacks like CSRF or XSS are still not clear to many of us. It is not because they are super hard to understand, but it requires some basic understanding of concepts like SOP, CORS, CSP, HTTPS. In this series of posts, I’ll try to clear them up one-by-one, and next time you read about attacks, you’ll understand everything.&lt;/p&gt;
&lt;p&gt;
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 960px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 66.69921875%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAABAADBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAD/9oADAMBAAIQAxAAAAHol1NKroEf/8QAGhAAAwADAQAAAAAAAAAAAAAAAAECERIhE//aAAgBAQABBQK7wejbm8j6UtCb5//EABYRAQEBAAAAAAAAAAAAAAAAAAEAEv/aAAgBAwEBPwECzf/EABYRAQEBAAAAAAAAAAAAAAAAAAEAEv/aAAgBAgEBPwFW03//xAAYEAADAQEAAAAAAAAAAAAAAAAAITEBIP/aAAgBAQAGPwJFeE4//8QAHBAAAwACAwEAAAAAAAAAAAAAAAERITFhgZGh/9oACAEBAAE/IeWFQbU6Gq3G8RiVPrE65tbHej//2gAMAwEAAgADAAAAEOAv/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAEDAQE/EMiy/8QAFxEBAAMAAAAAAAAAAAAAAAAAAAERMf/aAAgBAgEBPxC5qF//xAAcEAEBAAMAAwEAAAAAAAAAAAABEQAhMUFRYcH/2gAIAQEAAT8QcElDtOPjH+iUSKC/uMqAxdD3vJhSm4XClFP6GYBwenuf/9k=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;cover&quot;
        title=&quot;&quot;
        src=&quot;/static/40ec2d50e0bcc2627cb6e147c427ad7a/b3ee8/cover.jpg&quot;
        srcset=&quot;/static/40ec2d50e0bcc2627cb6e147c427ad7a/3bc27/cover.jpg 240w,
/static/40ec2d50e0bcc2627cb6e147c427ad7a/98431/cover.jpg 480w,
/static/40ec2d50e0bcc2627cb6e147c427ad7a/b3ee8/cover.jpg 960w,
/static/40ec2d50e0bcc2627cb6e147c427ad7a/1f853/cover.jpg 1024w&quot;
        sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  &lt;figcaption&gt;Photo by &lt;a href=&quot;https://unsplash.com/@randyfath&quot;&gt;Randy Fath&lt;/a&gt; on &lt;a href=&quot;https://unsplash.com&quot;&gt;Unsplash&lt;/a&gt;&lt;/figcaption&gt;&lt;/p&gt;
&lt;h3&gt;What is Same-origin Policy(SOP)&lt;/h3&gt;
&lt;p&gt;It is a security measure implemented by most browsers to protect users from the bad guys. It’s meant to keep you secure and it isn’t something new. It dates back to the old Netscape times. What it does is simple, blocks reading resources from other domains, only same-origin is allowed.&lt;/p&gt;
&lt;p&gt;The resource here can be the DOM of an iframe you embedded in the page, a JSON response in an http request, or cookies.&lt;/p&gt;
&lt;p&gt;Why does it exist? It’s there to keep you secure from the malicious scripts which might be running on the websites you visit. Although you’re visiting &lt;em&gt;evil.com&lt;/em&gt;, scripts running on this site can make requests to &lt;em&gt;my-bank.com/get-account-details&lt;/em&gt;, or embed an iframe with source &lt;em&gt;my-bank.com/get-account-details&lt;/em&gt; and then try to read the response/DOM to access your data. In case you think &lt;em&gt;“it’s fine as they don’t know my credentials”&lt;/em&gt;, think twice. Browser will use existing cookies for &lt;em&gt;my-bank.com&lt;/em&gt; automatically. It means if you have an active session on &lt;em&gt;my-bank.com&lt;/em&gt;, malicious scripts don’t need your credential.&lt;/p&gt;
&lt;p&gt;There are also some common misconceptions on SOP. It does not block sending requests to the backend. It only blocks reading the response. &lt;em&gt;“That’s great, let me trigger a call to mybank.com/transfer-money in my malicious script. I just want the request to reach the backend, I don’t care about the response, I’ll see it in my bank account anyways”&lt;/em&gt; you might be saying. Not that fast. Of course, from SOP point of view, that’s perfectly fine. But, there are other security measures to prevent that. That’s the most important aspect you should really understand about SOP. Let’s repeat again: you can freely send any request to any domain, SOP does not care about requests, it only blocks reading the response from other domains.&lt;/p&gt;
&lt;p&gt;Due to the same reason above, SOP not blocking the requests, it does not help with CSRF attacks. This attack relies on sending the request under the hood with the cookies you already have for that domain . It does not care about the response.&lt;/p&gt;
&lt;p&gt;If you’re saying &lt;em&gt;“yes, there is no news here to me”&lt;/em&gt;, great! you can stop reading. Otherwise, keep going.&lt;/p&gt;
&lt;h3&gt;What is considered as same-origin&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;Protocol&lt;/strong&gt; (http, https) &lt;strong&gt;+Host&lt;/strong&gt; (example.com) &lt;strong&gt;+Port&lt;/strong&gt; (8080)&lt;/p&gt;
&lt;p&gt;Given definition above, &lt;a href=&quot;http://example.com/abc&quot;&gt;http://example.com/abc&lt;/a&gt; and &lt;a href=&quot;http://example.com/xyz&quot;&gt;http://example.com/xyz&lt;/a&gt; will be in the same-origin, but not&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://example.com:8000/abc&quot;&gt;http://example.com:8000/abc&lt;/a&gt; due to different port&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://example.com/abc&quot;&gt;https://example.com/abc&lt;/a&gt; due to different protocol&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://example.com/abc&quot;&gt;http://test.example.com/abc&lt;/a&gt; due to different host&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;SOP to rescue&lt;/h3&gt;
&lt;p&gt;Please note that below examples assume there is no additional security checks at the backend and focuses on SOP only.&lt;/p&gt;
&lt;h4&gt;iframe&lt;/h4&gt;
&lt;p&gt;What happens when you type &lt;em&gt;gmail.com&lt;/em&gt;? Assuming you have an account and already logged-in before, it will show all your emails. Let’s say I own &lt;em&gt;evil.com&lt;/em&gt; and used an iframe to embed &lt;em&gt;gmail.com&lt;/em&gt; in it. Once you hit &lt;em&gt;evil.com&lt;/em&gt;, can you imagine what can go wrong if I read the content in that iframe with JavaScript as being the owner of &lt;em&gt;evil.com&lt;/em&gt;? Yes, you guessed it, I can read all your emails and even save them in some DB. But, don’t worry. Since you’re on &lt;em&gt;evil.com&lt;/em&gt;, scripts running on this domain will not be able to read DOM content in an iframe from another domain (ie. &lt;em&gt;gmail.com&lt;/em&gt;).&lt;/p&gt;
&lt;p&gt;SOP saves the day and blocks reading the DOM of an iframe which belong to another domain.&lt;/p&gt;
&lt;h4&gt;http request&lt;/h4&gt;
&lt;p&gt;I hear some of you saying &lt;em&gt;“I never used iframe, do you have some other example?”&lt;/em&gt;. Okay, let’s give the same example without iframes. I own &lt;em&gt;evil.com&lt;/em&gt; and you visit it since you don’t know I do evil things. The JS code I added in &lt;em&gt;evil.com&lt;/em&gt; sends a GET request to &lt;em&gt;gmail.com/get-all-emails&lt;/em&gt;. Do you think I’ll be able to send it?&lt;/p&gt;
&lt;p&gt;The answer is yes (what?!). Just to point out again, SOP does not do anything for the requests, it blocks response only. My request will be sent to gmail and browser will get a 200 success. When my script tries to see the response, however, it won’t be able to, neither will you when you check Network/Response tab in Chrome dev tools. Browser will block it as SOP promised. (This can be relaxed using CORS though)&lt;/p&gt;
&lt;p&gt;SOP rescues us again and blocks reading the response of an http request from another domain.&lt;/p&gt;
&lt;h4&gt;cookies&lt;/h4&gt;
&lt;p&gt;Web mostly relies on cookies for authentication. Web server sets some cookies for its domain so that it can identify you when it receives a request from you. To keep things simple, let’s say when you login to &lt;em&gt;gmail.com&lt;/em&gt; it sets a cookie username=“test@gmail.com” for domain gmail.com. Whenever there is a request going to gmail.com, your browser will add all your valid cookies belong to that domain. That means, when you call &lt;em&gt;gmail.com/get-all-emails&lt;/em&gt;, it will also send username=”test@gmail.com” without you realising. And Gmail’s web server will see who you are from the cookie and return all the emails you have.&lt;/p&gt;
&lt;p&gt;In real world, it’s not that simple. Gmail actually sets something to identify you, but it’s more complex and if anyone changes any part of that string, they would know and refuse to respond to your request.&lt;/p&gt;
&lt;p&gt;I think it’s somewhat clear now that whoever has that string can actually get all your emails. So, it’s super important for the browser not to expose cookies from one domain to another one. Again, as being the owner of &lt;em&gt;evil.com&lt;/em&gt;, I can send a request to &lt;em&gt;gmail.com&lt;/em&gt; on your behalf and browser will include all cookies belong to &lt;em&gt;gmail.com&lt;/em&gt; domain. But, the scripts running on evil.com won’t be able to read the cookies and server’s response. Yayy!&lt;/p&gt;
&lt;p&gt;Just a small note on this: different protocol and port does not make a resource cross-domain for cookies. For example, &lt;a href=&quot;http://example.com&quot;&gt;http://example.com&lt;/a&gt;, &lt;a href=&quot;https://example.com&quot;&gt;https://example.com&lt;/a&gt; and &lt;a href=&quot;https://example.com:7000&quot;&gt;https://example.com:7000&lt;/a&gt; are considered as the same-origin.&lt;/p&gt;
&lt;h4&gt;form&lt;/h4&gt;
&lt;p&gt;&lt;em&gt;“What about if I use a form”&lt;/em&gt; I hear you ask. Let’s say I did some JS tricks and submitted a form using my malicious code running on &lt;em&gt;evil.com&lt;/em&gt; which sends a request to &lt;em&gt;gmail.com/send-email&lt;/em&gt; with the payload I provided in the code. Same goes here, browser will send it. But after submitting, browser will take you from &lt;em&gt;evil.com&lt;/em&gt; to the action url (ie. &lt;em&gt;gmail.com/send-email&lt;/em&gt;), so &lt;em&gt;evil.com couldn’t&lt;/em&gt; read the response from other domains as the user is redirected to &lt;em&gt;gmail&lt;/em&gt;. Please note, this is not a feature of SOP, just default form behaviour in browsers.&lt;/p&gt;
&lt;h3&gt;Is everything coming from another domain blocked?&lt;/h3&gt;
&lt;p&gt;Nope. You can still&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Embed iframes&lt;/li&gt;
&lt;li&gt;Use image, audio, video files&lt;/li&gt;
&lt;li&gt;Import script and css files&lt;/li&gt;
&lt;li&gt;Submit forms&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;However, you&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;cannot read the DOM of the iframe you embedded&lt;/li&gt;
&lt;li&gt;cannot read the files/bytes of the image, audio and video files.&lt;/li&gt;
&lt;li&gt;cannot read the content of JS, CSS files you imported&lt;/li&gt;
&lt;li&gt;cannot read the response of the submitted form&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;In addition to that, there are some techniques for relaxing SOP. You can use Cross-origin Resource Sharing(CORS), JSON with Padding(JSONP), and some others. Please note, this is not something browser can do alone to workaround SOP. Both frontend and backend need to be configured properly to achieve accessing cross-domain resources.&lt;/p&gt;
&lt;h3&gt;Wrap up&lt;/h3&gt;
&lt;p&gt;Browsers implement SOP to keep your resources secure since you never now what’s going on behind the scenes when you visit &lt;em&gt;evil.com&lt;/em&gt;. SOP does not prevent taking actions(sending requests etc), but makes sure bad guys won’t be able to see the outcome of that action(reading response/cookies/DOM).&lt;/p&gt;
&lt;p&gt;It does not block you from using images, videos, scripts, css files from other domains. Long live CDNs! And there are ways to relax SOP by using things like CORS, JSONP.&lt;/p&gt;
&lt;p&gt;Hope this post gave you some understanding of Same-origin Policy. Keep reading other unknowns in my other posts to have the full picture. Fell free to leave comments below.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Indexing DynamoDB Items to ElasticSearch using AWS Lambda]]></title><description><![CDATA[DynamoDB is Amazon’s NoSQL database which offers single-digit milliseconds latency. It is great for variety of use cases, but when you need to run complex search queries on your dataset, you quickly realise it is not designed for it.]]></description><link>https://merictaze.com/posts/indexing-dynamodb-items-to-elasticsearch-using-aws-lambda/</link><guid isPermaLink="false">https://merictaze.com/posts/indexing-dynamodb-items-to-elasticsearch-using-aws-lambda/</guid><pubDate>Wed, 04 Jul 2018 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/8314334f2eb0b6a593e78008377cbae9/aac00/cover.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 774px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 49.6124031007752%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIBBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHtVSNFf//EABgQAAIDAAAAAAAAAAAAAAAAAAEhAhEg/9oACAEBAAEFAmJWsf/EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABoQAAICAwAAAAAAAAAAAAAAAAERACEgQVH/2gAIAQEABj8CVl75DRx//8QAGhABAQACAwAAAAAAAAAAAAAAAQARMRBBUf/aAAgBAQABPyHJsBTCxNHXsangv//aAAwDAQACAAMAAAAQaA//xAAWEQADAAAAAAAAAAAAAAAAAAABECH/2gAIAQMBAT8QEX//xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAgEBPxBn/8QAHBABAAICAwEAAAAAAAAAAAAAAQARITEQQWFx/9oACAEBAAE/ECy0zhQ6GBNnUVfxEtnHjNuNJ//Z&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;cover&quot;
        title=&quot;&quot;
        src=&quot;/static/8314334f2eb0b6a593e78008377cbae9/aac00/cover.jpg&quot;
        srcset=&quot;/static/8314334f2eb0b6a593e78008377cbae9/3bc27/cover.jpg 240w,
/static/8314334f2eb0b6a593e78008377cbae9/98431/cover.jpg 480w,
/static/8314334f2eb0b6a593e78008377cbae9/aac00/cover.jpg 774w&quot;
        sizes=&quot;(max-width: 774px) 100vw, 774px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;DynamoDB is Amazon’s NoSQL database which offers single-digit milliseconds latency. It is great for variety of use cases, but when you need to run complex search queries on your dataset, you quickly realise it is not designed for it.  &lt;/p&gt;
&lt;p&gt;You can try using composite primary keys, local and global secondary indexes to fulfil your needs. But as the queries get more complex, you might realise those are not enough. But don’t worry, you are not alone. Lots of people who have faced with this problem chose a similar solution; using ElasticSearch for their complex search operations while keeping the DynamoDB as the authority for the data.  &lt;/p&gt;
&lt;p&gt;Here we are going to learn how ElasticSearch can be plugged into your DynamoDB with a click of a button using CloudFormation.&lt;/p&gt;
&lt;p&gt;The same steps can be done using AWS Web Console, but I think making use of CloudFormation is better as often times you need to create the same resources for multiple stages and regions.&lt;/p&gt;
&lt;h3&gt;Creating DynamoDB Table&lt;/h3&gt;
&lt;p&gt;Let’s start with creating a DynamoDB table using CloudFormation. Here we create a table called ‘OrderTable’ whose key is orderId. It also sets read/write capacity to 5. One of the most important things here is that we also enable DynamoDB streams. Whenever an entry is created or updated, it will be streamed automatically. It will only return the new image, but you have &lt;a href=&quot;https://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API_StreamSpecification.html&quot;&gt;other options&lt;/a&gt; if you also need the old image or just the keys.&lt;/p&gt;
&lt;p&gt;&lt;div id=&quot;gist90498564&quot; class=&quot;gist&quot;&gt;
    &lt;div class=&quot;gist-file&quot;&gt;
      &lt;div class=&quot;gist-data&quot;&gt;
        &lt;div class=&quot;js-gist-file-update-container js-task-list-container file-box&quot;&gt;
  &lt;div id=&quot;file-ddb2es-01-cf-dynamo-yml&quot; class=&quot;file&quot;&gt;
    

  &lt;div itemprop=&quot;text&quot; class=&quot;Box-body p-0 blob-wrapper data type-yaml &quot;&gt;
      
&lt;table class=&quot;highlight tab-size js-file-line-container&quot; data-tab-size=&quot;8&quot;&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-01-cf-dynamo-yml-L1&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;1&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-01-cf-dynamo-yml-LC1&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-ent&quot;&gt;OrderTable&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-01-cf-dynamo-yml-L2&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;2&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-01-cf-dynamo-yml-LC2&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;  &lt;span class=&quot;pl-ent&quot;&gt;Type&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;AWS::DynamoDB::Table&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-01-cf-dynamo-yml-L3&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;3&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-01-cf-dynamo-yml-LC3&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;  &lt;span class=&quot;pl-ent&quot;&gt;Properties&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-01-cf-dynamo-yml-L4&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;4&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-01-cf-dynamo-yml-LC4&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    &lt;span class=&quot;pl-ent&quot;&gt;AttributeDefinitions&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-01-cf-dynamo-yml-L5&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;5&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-01-cf-dynamo-yml-LC5&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;      - &lt;span class=&quot;pl-ent&quot;&gt;AttributeName&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;orderId&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-01-cf-dynamo-yml-L6&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;6&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-01-cf-dynamo-yml-LC6&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        &lt;span class=&quot;pl-ent&quot;&gt;AttributeType&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;S&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-01-cf-dynamo-yml-L7&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;7&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-01-cf-dynamo-yml-LC7&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    &lt;span class=&quot;pl-ent&quot;&gt;KeySchema&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-01-cf-dynamo-yml-L8&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;8&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-01-cf-dynamo-yml-LC8&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;      - &lt;span class=&quot;pl-ent&quot;&gt;AttributeName&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;orderId&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-01-cf-dynamo-yml-L9&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;9&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-01-cf-dynamo-yml-LC9&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        &lt;span class=&quot;pl-ent&quot;&gt;KeyType&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;HASH&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-01-cf-dynamo-yml-L10&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;10&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-01-cf-dynamo-yml-LC10&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    &lt;span class=&quot;pl-ent&quot;&gt;ProvisionedThroughput&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-01-cf-dynamo-yml-L11&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;11&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-01-cf-dynamo-yml-LC11&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;      &lt;span class=&quot;pl-ent&quot;&gt;ReadCapacityUnits&lt;/span&gt;: &lt;span class=&quot;pl-c1&quot;&gt;5&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-01-cf-dynamo-yml-L12&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;12&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-01-cf-dynamo-yml-LC12&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;      &lt;span class=&quot;pl-ent&quot;&gt;WriteCapacityUnits&lt;/span&gt;: &lt;span class=&quot;pl-c1&quot;&gt;5&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-01-cf-dynamo-yml-L13&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;13&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-01-cf-dynamo-yml-LC13&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    &lt;span class=&quot;pl-ent&quot;&gt;TableName&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;OrderTable&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-01-cf-dynamo-yml-L14&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;14&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-01-cf-dynamo-yml-LC14&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    &lt;span class=&quot;pl-ent&quot;&gt;StreamSpecification&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-01-cf-dynamo-yml-L15&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;15&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-01-cf-dynamo-yml-LC15&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;      &lt;span class=&quot;pl-ent&quot;&gt;StreamViewType&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;NEW_IMAGE&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
&lt;/table&gt;


  &lt;/div&gt;

  &lt;/div&gt;
&lt;/div&gt;

      &lt;/div&gt;
      &lt;div class=&quot;gist-meta&quot;&gt;
        &lt;a href=&quot;https://gist.github.com/merictaze/0ce057b395b5c3ae88e79b6da08236b6/raw/c863fe999aec90abbc2652ff73d635c72ace6fe9/ddb2es-01-cf-dynamo.yml&quot; style=&quot;float:right&quot;&gt;view raw&lt;/a&gt;
        &lt;a href=&quot;https://gist.github.com/merictaze/0ce057b395b5c3ae88e79b6da08236b6#file-ddb2es-01-cf-dynamo-yml&quot;&gt;ddb2es-01-cf-dynamo.yml&lt;/a&gt;
        hosted with &amp;#10084; by &lt;a href=&quot;https://github.com&quot;&gt;GitHub&lt;/a&gt;
      &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;If you already have an existing table and don’t want to create a new one, you can get its SourceArn from AWS Web Console, and use it in the following sections.&lt;/p&gt;
&lt;h3&gt;Adding a Lambda function&lt;/h3&gt;
&lt;p&gt;Here we print the records coming from DynamoDB stream. We also add a Role to access various AWS resources from our lambda function which we’ll cover later. We use ZipFile which allows adding inline code to our CloudFormation template.&lt;/p&gt;
&lt;p&gt;&lt;div id=&quot;gist90498566&quot; class=&quot;gist&quot;&gt;
    &lt;div class=&quot;gist-file&quot;&gt;
      &lt;div class=&quot;gist-data&quot;&gt;
        &lt;div class=&quot;js-gist-file-update-container js-task-list-container file-box&quot;&gt;
  &lt;div id=&quot;file-ddb2es-02-cf-lambda-yml&quot; class=&quot;file&quot;&gt;
    

  &lt;div itemprop=&quot;text&quot; class=&quot;Box-body p-0 blob-wrapper data type-yaml &quot;&gt;
      
&lt;table class=&quot;highlight tab-size js-file-line-container&quot; data-tab-size=&quot;8&quot;&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-02-cf-lambda-yml-L1&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;1&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-02-cf-lambda-yml-LC1&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-ent&quot;&gt;EsIndexerFunction&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-02-cf-lambda-yml-L2&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;2&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-02-cf-lambda-yml-LC2&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;  &lt;span class=&quot;pl-ent&quot;&gt;Type&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;AWS::Lambda::Function&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-02-cf-lambda-yml-L3&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;3&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-02-cf-lambda-yml-LC3&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;  &lt;span class=&quot;pl-ent&quot;&gt;Properties&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-02-cf-lambda-yml-L4&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;4&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-02-cf-lambda-yml-LC4&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    &lt;span class=&quot;pl-ent&quot;&gt;Handler&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;index.handler&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-02-cf-lambda-yml-L5&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;5&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-02-cf-lambda-yml-LC5&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    &lt;span class=&quot;pl-ent&quot;&gt;Runtime&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;nodejs6.10&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-02-cf-lambda-yml-L6&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;6&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-02-cf-lambda-yml-LC6&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    &lt;span class=&quot;pl-ent&quot;&gt;Role&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;!GetAtt LambdaRole.Arn&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-02-cf-lambda-yml-L7&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;7&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-02-cf-lambda-yml-LC7&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    &lt;span class=&quot;pl-ent&quot;&gt;Code&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-02-cf-lambda-yml-L8&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;8&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-02-cf-lambda-yml-LC8&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;      &lt;span class=&quot;pl-ent&quot;&gt;ZipFile&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;|&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-02-cf-lambda-yml-L9&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;9&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-02-cf-lambda-yml-LC9&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-s&quot;&gt;        exports.handler = (event, context, callback) =&amp;gt; {&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-02-cf-lambda-yml-L10&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;10&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-02-cf-lambda-yml-LC10&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-s&quot;&gt;          event.Records.forEach(record =&amp;gt; {&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-02-cf-lambda-yml-L11&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;11&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-02-cf-lambda-yml-LC11&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-s&quot;&gt;            console.log(record);&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-02-cf-lambda-yml-L12&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;12&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-02-cf-lambda-yml-LC12&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-s&quot;&gt;          });&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-02-cf-lambda-yml-L13&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;13&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-02-cf-lambda-yml-LC13&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-s&quot;&gt;        }&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
&lt;/table&gt;


  &lt;/div&gt;

  &lt;/div&gt;
&lt;/div&gt;

      &lt;/div&gt;
      &lt;div class=&quot;gist-meta&quot;&gt;
        &lt;a href=&quot;https://gist.github.com/merictaze/0c4add0c9c275d8e726df7db47f0e498/raw/e9eeb89f8ac766db15b810786ac2d0f58d17a099/ddb2es-02-cf-lambda.yml&quot; style=&quot;float:right&quot;&gt;view raw&lt;/a&gt;
        &lt;a href=&quot;https://gist.github.com/merictaze/0c4add0c9c275d8e726df7db47f0e498#file-ddb2es-02-cf-lambda-yml&quot;&gt;ddb2es-02-cf-lambda.yml&lt;/a&gt;
        hosted with &amp;#10084; by &lt;a href=&quot;https://github.com&quot;&gt;GitHub&lt;/a&gt;
      &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;&lt;/p&gt;
&lt;h3&gt;Mapping between the stream and lambda function&lt;/h3&gt;
&lt;p&gt;This defines the mapping between DynamoDB Stream and our Lambda function. Whenever there is something new in DynamoDB Streams, it will trigger our lambda function with those records.&lt;/p&gt;
&lt;p&gt;&lt;div id=&quot;gist90498567&quot; class=&quot;gist&quot;&gt;
    &lt;div class=&quot;gist-file&quot;&gt;
      &lt;div class=&quot;gist-data&quot;&gt;
        &lt;div class=&quot;js-gist-file-update-container js-task-list-container file-box&quot;&gt;
  &lt;div id=&quot;file-ddb2es-03-cf-mapping-yml&quot; class=&quot;file&quot;&gt;
    

  &lt;div itemprop=&quot;text&quot; class=&quot;Box-body p-0 blob-wrapper data type-yaml &quot;&gt;
      
&lt;table class=&quot;highlight tab-size js-file-line-container&quot; data-tab-size=&quot;8&quot;&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-03-cf-mapping-yml-L1&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;1&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-03-cf-mapping-yml-LC1&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-ent&quot;&gt;TableStreamLambdaMapping&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-03-cf-mapping-yml-L2&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;2&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-03-cf-mapping-yml-LC2&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;  &lt;span class=&quot;pl-ent&quot;&gt;Type&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;AWS::Lambda::EventSourceMapping&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-03-cf-mapping-yml-L3&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;3&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-03-cf-mapping-yml-LC3&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;  &lt;span class=&quot;pl-ent&quot;&gt;Properties&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-03-cf-mapping-yml-L4&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;4&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-03-cf-mapping-yml-LC4&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    &lt;span class=&quot;pl-ent&quot;&gt;BatchSize&lt;/span&gt;: &lt;span class=&quot;pl-c1&quot;&gt;2&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-03-cf-mapping-yml-L5&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;5&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-03-cf-mapping-yml-LC5&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    &lt;span class=&quot;pl-ent&quot;&gt;EventSourceArn&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;!GetAtt OrderTable.StreamArn&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-03-cf-mapping-yml-L6&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;6&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-03-cf-mapping-yml-LC6&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    &lt;span class=&quot;pl-ent&quot;&gt;FunctionName&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;!GetAtt EsIndexerFunction.Arn&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-03-cf-mapping-yml-L7&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;7&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-03-cf-mapping-yml-LC7&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    &lt;span class=&quot;pl-ent&quot;&gt;StartingPosition&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;LATEST&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
&lt;/table&gt;


  &lt;/div&gt;

  &lt;/div&gt;
&lt;/div&gt;

      &lt;/div&gt;
      &lt;div class=&quot;gist-meta&quot;&gt;
        &lt;a href=&quot;https://gist.github.com/merictaze/aea2be7119a77d3fcecd25872fbdf0ae/raw/f7d50282afb90fe34bb9179329b55338477a1f7a/ddb2es-03-cf-mapping.yml&quot; style=&quot;float:right&quot;&gt;view raw&lt;/a&gt;
        &lt;a href=&quot;https://gist.github.com/merictaze/aea2be7119a77d3fcecd25872fbdf0ae#file-ddb2es-03-cf-mapping-yml&quot;&gt;ddb2es-03-cf-mapping.yml&lt;/a&gt;
        hosted with &amp;#10084; by &lt;a href=&quot;https://github.com&quot;&gt;GitHub&lt;/a&gt;
      &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;&lt;/p&gt;
&lt;h3&gt;Lambda IAM role&lt;/h3&gt;
&lt;p&gt;Here we give our lambda function access for writing logs so that we can check them in CloudWatch and also access for reading DynamoDB streams.&lt;/p&gt;
&lt;p&gt;&lt;div id=&quot;gist90498568&quot; class=&quot;gist&quot;&gt;
    &lt;div class=&quot;gist-file&quot;&gt;
      &lt;div class=&quot;gist-data&quot;&gt;
        &lt;div class=&quot;js-gist-file-update-container js-task-list-container file-box&quot;&gt;
  &lt;div id=&quot;file-ddb2es-04-cf-lambdarole-yml&quot; class=&quot;file&quot;&gt;
    

  &lt;div itemprop=&quot;text&quot; class=&quot;Box-body p-0 blob-wrapper data type-yaml &quot;&gt;
      
&lt;table class=&quot;highlight tab-size js-file-line-container&quot; data-tab-size=&quot;8&quot;&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-L1&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;1&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-LC1&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-ent&quot;&gt;LambdaRole&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-L2&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;2&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-LC2&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;  &lt;span class=&quot;pl-ent&quot;&gt;Type&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;AWS::IAM::Role&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-L3&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;3&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-LC3&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;  &lt;span class=&quot;pl-ent&quot;&gt;Properties&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-L4&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;4&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-LC4&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    &lt;span class=&quot;pl-ent&quot;&gt;AssumeRolePolicyDocument&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-L5&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;5&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-LC5&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;      &lt;span class=&quot;pl-ent&quot;&gt;Version&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;2012-10-17&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-L6&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;6&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-LC6&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;      &lt;span class=&quot;pl-ent&quot;&gt;Statement&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-L7&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;7&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-LC7&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;      - &lt;span class=&quot;pl-ent&quot;&gt;Effect&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;Allow&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-L8&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;8&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-LC8&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        &lt;span class=&quot;pl-ent&quot;&gt;Principal&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-L9&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;9&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-LC9&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;          &lt;span class=&quot;pl-ent&quot;&gt;Service&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;lambda.amazonaws.com&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-L10&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;10&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-LC10&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        &lt;span class=&quot;pl-ent&quot;&gt;Action&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;sts:AssumeRole&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-L11&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;11&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-LC11&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    &lt;span class=&quot;pl-ent&quot;&gt;Path&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;/&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-L12&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;12&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-LC12&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    &lt;span class=&quot;pl-ent&quot;&gt;Policies&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-L13&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;13&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-LC13&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;      - &lt;span class=&quot;pl-ent&quot;&gt;PolicyName&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;LambdaRolePolicy&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-L14&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;14&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-LC14&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        &lt;span class=&quot;pl-ent&quot;&gt;PolicyDocument&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-L15&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;15&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-LC15&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;          &lt;span class=&quot;pl-ent&quot;&gt;Version&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;2012-10-17&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-L16&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;16&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-LC16&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;          &lt;span class=&quot;pl-ent&quot;&gt;Statement&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-L17&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;17&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-LC17&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;          - &lt;span class=&quot;pl-ent&quot;&gt;Effect&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;Allow&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-L18&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;18&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-LC18&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            &lt;span class=&quot;pl-ent&quot;&gt;Action&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-L19&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;19&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-LC19&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            - &lt;span class=&quot;pl-s&quot;&gt;logs:CreateLogGroup&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-L20&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;20&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-LC20&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            - &lt;span class=&quot;pl-s&quot;&gt;logs:CreateLogStream&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-L21&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;21&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-LC21&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            - &lt;span class=&quot;pl-s&quot;&gt;logs:PutLogEvents&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-L22&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;22&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-LC22&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            &lt;span class=&quot;pl-ent&quot;&gt;Resource&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;arn:aws:logs:*:*:*&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-L23&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;23&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-LC23&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;          - &lt;span class=&quot;pl-ent&quot;&gt;Effect&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;Allow&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-L24&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;24&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-LC24&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            &lt;span class=&quot;pl-ent&quot;&gt;Action&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-L25&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;25&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-LC25&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            - &lt;span class=&quot;pl-s&quot;&gt;dynamodb:DescribeStream&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-L26&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;26&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-LC26&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            - &lt;span class=&quot;pl-s&quot;&gt;dynamodb:GetRecords&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-L27&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;27&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-LC27&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            - &lt;span class=&quot;pl-s&quot;&gt;dynamodb:GetShardIterator&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-L28&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;28&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-LC28&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            - &lt;span class=&quot;pl-s&quot;&gt;dynamodb:ListStreams&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-L29&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;29&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-04-cf-lambdarole-yml-LC29&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            &lt;span class=&quot;pl-ent&quot;&gt;Resource&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;!GetAtt OrderTable.StreamArn&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
&lt;/table&gt;


  &lt;/div&gt;

  &lt;/div&gt;
&lt;/div&gt;

      &lt;/div&gt;
      &lt;div class=&quot;gist-meta&quot;&gt;
        &lt;a href=&quot;https://gist.github.com/merictaze/2c9bdd95e66a9226a34e61ca4f1f6a0c/raw/290eeb766b66c1b5354ebb98d1b1597a1b314506/ddb2es-04-cf-lambdarole.yml&quot; style=&quot;float:right&quot;&gt;view raw&lt;/a&gt;
        &lt;a href=&quot;https://gist.github.com/merictaze/2c9bdd95e66a9226a34e61ca4f1f6a0c#file-ddb2es-04-cf-lambdarole-yml&quot;&gt;ddb2es-04-cf-lambdarole.yml&lt;/a&gt;
        hosted with &amp;#10084; by &lt;a href=&quot;https://github.com&quot;&gt;GitHub&lt;/a&gt;
      &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;&lt;/p&gt;
&lt;h3&gt;Adding ElasticSearch&lt;/h3&gt;
&lt;p&gt;This creates a t2.micro ElasticSearch instance which is included in Free Tier. It also allows LambdaRole to access to the instance.&lt;/p&gt;
&lt;p&gt;&lt;div id=&quot;gist90498571&quot; class=&quot;gist&quot;&gt;
    &lt;div class=&quot;gist-file&quot;&gt;
      &lt;div class=&quot;gist-data&quot;&gt;
        &lt;div class=&quot;js-gist-file-update-container js-task-list-container file-box&quot;&gt;
  &lt;div id=&quot;file-ddb2es-05-cf-elasticsearch-yml&quot; class=&quot;file&quot;&gt;
    

  &lt;div itemprop=&quot;text&quot; class=&quot;Box-body p-0 blob-wrapper data type-yaml &quot;&gt;
      
&lt;table class=&quot;highlight tab-size js-file-line-container&quot; data-tab-size=&quot;8&quot;&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-05-cf-elasticsearch-yml-L1&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;1&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-05-cf-elasticsearch-yml-LC1&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-ent&quot;&gt;ElasticsearchDomain&lt;/span&gt;: &lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-05-cf-elasticsearch-yml-L2&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;2&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-05-cf-elasticsearch-yml-LC2&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;  &lt;span class=&quot;pl-ent&quot;&gt;Type&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;AWS::Elasticsearch::Domain&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-05-cf-elasticsearch-yml-L3&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;3&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-05-cf-elasticsearch-yml-LC3&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;  &lt;span class=&quot;pl-ent&quot;&gt;Properties&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-05-cf-elasticsearch-yml-L4&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;4&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-05-cf-elasticsearch-yml-LC4&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    &lt;span class=&quot;pl-ent&quot;&gt;DomainName&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;es-order&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-05-cf-elasticsearch-yml-L5&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;5&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-05-cf-elasticsearch-yml-LC5&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    &lt;span class=&quot;pl-ent&quot;&gt;ElasticsearchClusterConfig&lt;/span&gt;: &lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-05-cf-elasticsearch-yml-L6&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;6&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-05-cf-elasticsearch-yml-LC6&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;      &lt;span class=&quot;pl-ent&quot;&gt;InstanceType&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;t2.micro.elasticsearch&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-05-cf-elasticsearch-yml-L7&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;7&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-05-cf-elasticsearch-yml-LC7&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;      &lt;span class=&quot;pl-ent&quot;&gt;InstanceCount&lt;/span&gt;: &lt;span class=&quot;pl-c1&quot;&gt;1&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-05-cf-elasticsearch-yml-L8&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;8&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-05-cf-elasticsearch-yml-LC8&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    &lt;span class=&quot;pl-ent&quot;&gt;EBSOptions&lt;/span&gt;: &lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-05-cf-elasticsearch-yml-L9&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;9&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-05-cf-elasticsearch-yml-LC9&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;      &lt;span class=&quot;pl-ent&quot;&gt;EBSEnabled&lt;/span&gt;: &lt;span class=&quot;pl-c1&quot;&gt;true&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-05-cf-elasticsearch-yml-L10&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;10&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-05-cf-elasticsearch-yml-LC10&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;      &lt;span class=&quot;pl-ent&quot;&gt;Iops&lt;/span&gt;: &lt;span class=&quot;pl-c1&quot;&gt;0&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-05-cf-elasticsearch-yml-L11&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;11&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-05-cf-elasticsearch-yml-LC11&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;      &lt;span class=&quot;pl-ent&quot;&gt;VolumeSize&lt;/span&gt;: &lt;span class=&quot;pl-c1&quot;&gt;10&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-05-cf-elasticsearch-yml-L12&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;12&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-05-cf-elasticsearch-yml-LC12&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;      &lt;span class=&quot;pl-ent&quot;&gt;VolumeType&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;standard&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-05-cf-elasticsearch-yml-L13&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;13&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-05-cf-elasticsearch-yml-LC13&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    &lt;span class=&quot;pl-ent&quot;&gt;AccessPolicies&lt;/span&gt;: &lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-05-cf-elasticsearch-yml-L14&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;14&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-05-cf-elasticsearch-yml-LC14&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;      &lt;span class=&quot;pl-ent&quot;&gt;Version&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;2012-10-17&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-05-cf-elasticsearch-yml-L15&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;15&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-05-cf-elasticsearch-yml-LC15&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;      &lt;span class=&quot;pl-ent&quot;&gt;Statement&lt;/span&gt;: &lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-05-cf-elasticsearch-yml-L16&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;16&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-05-cf-elasticsearch-yml-LC16&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        - &lt;span class=&quot;pl-ent&quot;&gt;Effect&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;Allow&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-05-cf-elasticsearch-yml-L17&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;17&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-05-cf-elasticsearch-yml-LC17&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;          &lt;span class=&quot;pl-ent&quot;&gt;Principal&lt;/span&gt;: &lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-05-cf-elasticsearch-yml-L18&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;18&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-05-cf-elasticsearch-yml-LC18&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            &lt;span class=&quot;pl-ent&quot;&gt;AWS&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;!GetAtt LambdaRole.Arn&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-05-cf-elasticsearch-yml-L19&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;19&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-05-cf-elasticsearch-yml-LC19&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;          &lt;span class=&quot;pl-ent&quot;&gt;Action&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;es:*&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-05-cf-elasticsearch-yml-L20&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;20&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-05-cf-elasticsearch-yml-LC20&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;          &lt;span class=&quot;pl-ent&quot;&gt;Resource&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;*&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-05-cf-elasticsearch-yml-L21&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;21&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-05-cf-elasticsearch-yml-LC21&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    &lt;span class=&quot;pl-ent&quot;&gt;AdvancedOptions&lt;/span&gt;: &lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-05-cf-elasticsearch-yml-L22&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;22&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-05-cf-elasticsearch-yml-LC22&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;      &lt;span class=&quot;pl-ent&quot;&gt;rest.action.multi.allow_explicit_index&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;true&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
&lt;/table&gt;


  &lt;/div&gt;

  &lt;/div&gt;
&lt;/div&gt;

      &lt;/div&gt;
      &lt;div class=&quot;gist-meta&quot;&gt;
        &lt;a href=&quot;https://gist.github.com/merictaze/0de4b21eaf7c4b03f31b700bafc03c65/raw/9eb1a23836ac5745cd5d3ed1d61f36212fa34653/ddb2es-05-cf-elasticsearch.yml&quot; style=&quot;float:right&quot;&gt;view raw&lt;/a&gt;
        &lt;a href=&quot;https://gist.github.com/merictaze/0de4b21eaf7c4b03f31b700bafc03c65#file-ddb2es-05-cf-elasticsearch-yml&quot;&gt;ddb2es-05-cf-elasticsearch.yml&lt;/a&gt;
        hosted with &amp;#10084; by &lt;a href=&quot;https://github.com&quot;&gt;GitHub&lt;/a&gt;
      &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;&lt;/p&gt;
&lt;h3&gt;Updating Lambda to index documents&lt;/h3&gt;
&lt;p&gt;Now let’s update our previous lambda function to index DynamoDB stream records to ElasticSearch. Note that we need to sign our requests, otherwise you’ll get an authorization error.  &lt;/p&gt;
&lt;p&gt;Consider using &lt;a href=&quot;https://github.com/TheDeveloper/http-aws-es&quot;&gt;http-aws-es&lt;/a&gt; library which makes things quite easy if you are using S3Bucket and S3Key instead of ZipFile. It allows you to use &lt;a href=&quot;https://github.com/elastic/elasticsearch-js&quot;&gt;elasticsearch-js&lt;/a&gt; client and also handles the request signing part.&lt;/p&gt;
&lt;p&gt;&lt;div id=&quot;gist90498572&quot; class=&quot;gist&quot;&gt;
    &lt;div class=&quot;gist-file&quot;&gt;
      &lt;div class=&quot;gist-data&quot;&gt;
        &lt;div class=&quot;js-gist-file-update-container js-task-list-container file-box&quot;&gt;
  &lt;div id=&quot;file-ddb2es-06-cf-lambda_v2-yml&quot; class=&quot;file&quot;&gt;
    

  &lt;div itemprop=&quot;text&quot; class=&quot;Box-body p-0 blob-wrapper data type-yaml &quot;&gt;
      
&lt;table class=&quot;highlight tab-size js-file-line-container&quot; data-tab-size=&quot;8&quot;&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L1&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;1&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC1&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-ent&quot;&gt;EsIndexerFunction&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L2&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;2&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC2&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    &lt;span class=&quot;pl-ent&quot;&gt;Type&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;AWS::Lambda::Function&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L3&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;3&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC3&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    &lt;span class=&quot;pl-ent&quot;&gt;Properties&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L4&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;4&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC4&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;      &lt;span class=&quot;pl-ent&quot;&gt;Handler&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;index.handler&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L5&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;5&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC5&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;      &lt;span class=&quot;pl-ent&quot;&gt;Runtime&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;nodejs6.10&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L6&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;6&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC6&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;      &lt;span class=&quot;pl-ent&quot;&gt;Role&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;!GetAtt LambdaRole.Arn&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L7&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;7&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC7&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;      &lt;span class=&quot;pl-ent&quot;&gt;Environment&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L8&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;8&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC8&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        &lt;span class=&quot;pl-ent&quot;&gt;Variables&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L9&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;9&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC9&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;          &lt;span class=&quot;pl-ent&quot;&gt;ES_ENDPOINT&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;!GetAtt ElasticsearchDomain.DomainEndpoint&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L10&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;10&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC10&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;          &lt;span class=&quot;pl-ent&quot;&gt;ES_REGION&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;!Ref AWS::Region&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L11&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;11&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC11&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;      &lt;span class=&quot;pl-ent&quot;&gt;Code&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L12&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;12&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC12&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        &lt;span class=&quot;pl-ent&quot;&gt;ZipFile&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;|&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L13&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;13&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC13&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-s&quot;&gt;          var AWS = require(&amp;#39;aws-sdk&amp;#39;);&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L14&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;14&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC14&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-s&quot;&gt;          var path = require(&amp;#39;path&amp;#39;);&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L15&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;15&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC15&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-s&quot;&gt;          var creds = new AWS.EnvironmentCredentials(&amp;#39;AWS&amp;#39;);&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L16&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;16&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC16&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-s&quot;&gt;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L17&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;17&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC17&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-s&quot;&gt;          var esDomain = {&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L18&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;18&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC18&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-s&quot;&gt;              endpoint: process.env.ES_ENDPOINT,&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L19&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;19&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC19&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-s&quot;&gt;              region: process.env.ES_REGION,&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L20&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;20&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC20&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-s&quot;&gt;              index: &amp;#39;test&amp;#39;,&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L21&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;21&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC21&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-s&quot;&gt;              doctype: &amp;#39;order&amp;#39;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L22&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;22&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC22&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-s&quot;&gt;          };&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L23&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;23&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC23&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-s&quot;&gt;          var endpoint =  new AWS.Endpoint(esDomain.endpoint);&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L24&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;24&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC24&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-s&quot;&gt;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L25&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;25&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC25&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-s&quot;&gt;          exports.handler = (event, context, callback) =&amp;gt; {&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L26&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;26&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC26&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-s&quot;&gt;            event.Records.forEach(record =&amp;gt; {&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L27&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;27&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC27&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-s&quot;&gt;              postDocumentToES(record.dynamodb.NewImage, context);&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L28&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;28&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC28&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-s&quot;&gt;            });&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L29&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;29&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC29&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-s&quot;&gt;          }&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L30&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;30&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC30&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-s&quot;&gt;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L31&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;31&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC31&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-s&quot;&gt;          function postDocumentToES(doc, context) {&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L32&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;32&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC32&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-s&quot;&gt;              var req = new AWS.HttpRequest(endpoint);&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L33&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;33&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC33&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-s&quot;&gt;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L34&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;34&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC34&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-s&quot;&gt;              req.method = &amp;#39;POST&amp;#39;;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L35&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;35&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC35&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-s&quot;&gt;              req.path = path.join(&amp;#39;/&amp;#39;, esDomain.index, esDomain.doctype);&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L36&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;36&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC36&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-s&quot;&gt;              req.region = esDomain.region;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L37&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;37&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC37&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-s&quot;&gt;              req.body = JSON.stringify(doc);&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L38&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;38&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC38&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-s&quot;&gt;              req.headers[&amp;#39;presigned-expires&amp;#39;] = false;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L39&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;39&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC39&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-s&quot;&gt;              req.headers[&amp;#39;Host&amp;#39;] = endpoint.host;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L40&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;40&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC40&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-s&quot;&gt;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L41&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;41&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC41&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-s&quot;&gt;              // Sign the request (Sigv4)&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L42&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;42&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC42&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-s&quot;&gt;              var signer = new AWS.Signers.V4(req, &amp;#39;es&amp;#39;);&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L43&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;43&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC43&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-s&quot;&gt;              signer.addAuthorization(creds, new Date());&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L44&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;44&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC44&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-s&quot;&gt;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L45&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;45&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC45&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-s&quot;&gt;              // Post document to ES&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L46&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;46&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC46&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-s&quot;&gt;              var send = new AWS.NodeHttpClient();&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L47&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;47&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC47&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-s&quot;&gt;              send.handleRequest(req, null, function(httpResp) {&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L48&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;48&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC48&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-s&quot;&gt;                  var body = &amp;#39;&amp;#39;;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L49&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;49&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC49&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-s&quot;&gt;                  httpResp.on(&amp;#39;data&amp;#39;, chunk =&amp;gt; body += chunk);&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L50&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;50&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC50&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-s&quot;&gt;                  httpResp.on(&amp;#39;end&amp;#39;, chunk =&amp;gt; context.succeed());&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L51&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;51&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC51&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-s&quot;&gt;              }, function(err) {&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L52&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;52&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC52&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-s&quot;&gt;                  console.log(&amp;#39;Error: &amp;#39; + err);&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L53&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;53&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC53&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-s&quot;&gt;                  context.fail();&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L54&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;54&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC54&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-s&quot;&gt;              });&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-L55&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;55&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-ddb2es-06-cf-lambda_v2-yml-LC55&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-s&quot;&gt;          }&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
&lt;/table&gt;


  &lt;/div&gt;

  &lt;/div&gt;
&lt;/div&gt;

      &lt;/div&gt;
      &lt;div class=&quot;gist-meta&quot;&gt;
        &lt;a href=&quot;https://gist.github.com/merictaze/0f3a80a2e5c069e2dcbf8a321d7d659d/raw/b866449382128db5fa6949ec9ff993a4add0b0de/ddb2es-06-cf-lambda_v2.yml&quot; style=&quot;float:right&quot;&gt;view raw&lt;/a&gt;
        &lt;a href=&quot;https://gist.github.com/merictaze/0f3a80a2e5c069e2dcbf8a321d7d659d#file-ddb2es-06-cf-lambda_v2-yml&quot;&gt;ddb2es-06-cf-lambda_v2.yml&lt;/a&gt;
        hosted with &amp;#10084; by &lt;a href=&quot;https://github.com&quot;&gt;GitHub&lt;/a&gt;
      &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;So at this point we have everything we need. All the new DynamoDB data is being indexed to ElasticSearch behind the scenes.  &lt;/p&gt;
&lt;p&gt;You can also see the full CloudFormation template &lt;a href=&quot;https://gist.github.com/merictaze/44cb99335300fb1121512eb9beea3ab3&quot;&gt;here&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Feel free to comment below if you have any questions or feedback.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Going Serverless Offline]]></title><description><![CDATA[In this post, we are going to setup an environment with API Gateway, Lambda and DynamoDB using serverless framework which can be deployed to AWS directly or run fully local.]]></description><link>https://merictaze.com/posts/going-serverless-offline/</link><guid isPermaLink="false">https://merictaze.com/posts/going-serverless-offline/</guid><pubDate>Tue, 03 Jul 2018 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/3842589b20fa127a7bfb0edae065241c/db310/cover.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 645px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 54.72868217054264%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAIBAwX/xAAUAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHbS0GBhP/EABkQAQACAwAAAAAAAAAAAAAAAAIBERASMf/aAAgBAQABBQK7U8C2Of/EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABgQAQEBAQEAAAAAAAAAAAAAAAERABIg/9oACAEBAAY/ApcvTDCeP//EABsQAQACAgMAAAAAAAAAAAAAAAEAERAhMUFR/9oACAEBAAE/IeAQhFXp3UC9UneTRqf/2gAMAwEAAgADAAAAEDAP/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAEDAQE/EKx//8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAECAQE/EI1//8QAGhABAAMBAQEAAAAAAAAAAAAAAQARITFBgf/aAAgBAQABPxBD3eNGbFxoXO8NrIhyvCKfsH32uzxKKe5MAADgE//Z&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;cover&quot;
        title=&quot;&quot;
        src=&quot;/static/3842589b20fa127a7bfb0edae065241c/db310/cover.jpg&quot;
        srcset=&quot;/static/3842589b20fa127a7bfb0edae065241c/3bc27/cover.jpg 240w,
/static/3842589b20fa127a7bfb0edae065241c/98431/cover.jpg 480w,
/static/3842589b20fa127a7bfb0edae065241c/db310/cover.jpg 645w&quot;
        sizes=&quot;(max-width: 645px) 100vw, 645px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;In this post, we are going to setup an environment with API Gateway, Lambda and DynamoDB using serverless framework which can be deployed to AWS directly or run fully local.&lt;/p&gt;
&lt;p&gt;What are the advantages of using offline:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Develop stress free without unexpected fees&lt;/li&gt;
&lt;li&gt;No need to wait for the deployment to finish to test every single change.&lt;/li&gt;
&lt;li&gt;Easier local debugging.&lt;/li&gt;
&lt;li&gt;When you’re ready, it takes just one command to deploy everything to AWS&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;You can also check the repositories of the individual plugins for more detailed information: &lt;a href=&quot;https://github.com/serverless/serverless&quot;&gt;serverless&lt;/a&gt;, &lt;a href=&quot;https://github.com/dherault/serverless-offline&quot;&gt;serverless-offline&lt;/a&gt; and &lt;a href=&quot;https://github.com/99xt/serverless-dynamodb-local&quot;&gt;serverless-dynamodb-local&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;Setting up serverless framework&lt;/h4&gt;
&lt;p&gt;Start with installing serverless framework if you have not already&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm install -g serverless&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;and setup your AWS credentials. You can create your key and secret from AWS Console&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;sls config credentials --provider aws --key \&amp;lt;KEY\&amp;gt; --secret \&amp;lt;SECRET\&amp;gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We’re all set to create our serverless project&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;serverless create --template aws-nodejs --path test-serverless&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This will create a serverless.yml file which contains the definition of our resources and example lambda function in handler.js&lt;/p&gt;
&lt;p&gt;At this point, you can deploy it to AWS using the below command in the project’s root folder&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;cd test-serverless
serverless deploy&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;As simple as that. But we’ll continue with setting up a local development environment.&lt;/p&gt;
&lt;h4&gt;Setting up the local development environment&lt;/h4&gt;
&lt;p&gt;We need two plugins here;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;serverless-offline which emulates AWS Lambda and API Gateway&lt;/li&gt;
&lt;li&gt;serverless-dynamodb-local which runs a local DynamoDB.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm install serverless-offline serverless-dynamodb-local --save-dev&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Next step is updating our serverless.yml file. We changed runtime to nodejs8.10 to use the latest features, added a trigger for our lambda function and also added plugins section. Note that order is important in the plugins section.&lt;/p&gt;
&lt;p&gt;&lt;div id=&quot;gist90509508&quot; class=&quot;gist&quot;&gt;
    &lt;div class=&quot;gist-file&quot;&gt;
      &lt;div class=&quot;gist-data&quot;&gt;
        &lt;div class=&quot;js-gist-file-update-container js-task-list-container file-box&quot;&gt;
  &lt;div id=&quot;file-serverless-offline-01-serverless-yml&quot; class=&quot;file&quot;&gt;
    

  &lt;div itemprop=&quot;text&quot; class=&quot;Box-body p-0 blob-wrapper data type-yaml &quot;&gt;
      
&lt;table class=&quot;highlight tab-size js-file-line-container&quot; data-tab-size=&quot;8&quot;&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-01-serverless-yml-L1&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;1&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-01-serverless-yml-LC1&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-ent&quot;&gt;service&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;test-serverless&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-01-serverless-yml-L2&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;2&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-01-serverless-yml-LC2&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-ent&quot;&gt;provider&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-01-serverless-yml-L3&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;3&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-01-serverless-yml-LC3&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;  &lt;span class=&quot;pl-ent&quot;&gt;name&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;aws&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-01-serverless-yml-L4&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;4&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-01-serverless-yml-LC4&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;  &lt;span class=&quot;pl-ent&quot;&gt;runtime&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;nodejs8.10&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-01-serverless-yml-L5&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;5&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-01-serverless-yml-LC5&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-ent&quot;&gt;functions&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-01-serverless-yml-L6&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;6&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-01-serverless-yml-LC6&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;  &lt;span class=&quot;pl-ent&quot;&gt;hello&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-01-serverless-yml-L7&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;7&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-01-serverless-yml-LC7&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    &lt;span class=&quot;pl-ent&quot;&gt;handler&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;handler.hello&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-01-serverless-yml-L8&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;8&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-01-serverless-yml-LC8&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    &lt;span class=&quot;pl-ent&quot;&gt;events&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-01-serverless-yml-L9&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;9&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-01-serverless-yml-LC9&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;      - &lt;span class=&quot;pl-ent&quot;&gt;http&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-01-serverless-yml-L10&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;10&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-01-serverless-yml-LC10&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;          &lt;span class=&quot;pl-ent&quot;&gt;path&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-01-serverless-yml-L11&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;11&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-01-serverless-yml-LC11&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;          &lt;span class=&quot;pl-ent&quot;&gt;method&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;get&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-01-serverless-yml-L12&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;12&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-01-serverless-yml-LC12&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-ent&quot;&gt;plugins&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-01-serverless-yml-L13&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;13&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-01-serverless-yml-LC13&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;  - &lt;span class=&quot;pl-s&quot;&gt;serverless-dynamodb-local&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-01-serverless-yml-L14&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;14&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-01-serverless-yml-LC14&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;  - &lt;span class=&quot;pl-s&quot;&gt;serverless-offline&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
&lt;/table&gt;


  &lt;/div&gt;

  &lt;/div&gt;
&lt;/div&gt;

      &lt;/div&gt;
      &lt;div class=&quot;gist-meta&quot;&gt;
        &lt;a href=&quot;https://gist.github.com/merictaze/068004266504369680dbb58c4df2c7e3/raw/2330354254dd5eb7e5ee41ecbfceb6db57a55f34/serverless-offline-01-serverless.yml&quot; style=&quot;float:right&quot;&gt;view raw&lt;/a&gt;
        &lt;a href=&quot;https://gist.github.com/merictaze/068004266504369680dbb58c4df2c7e3#file-serverless-offline-01-serverless-yml&quot;&gt;serverless-offline-01-serverless.yml&lt;/a&gt;
        hosted with &amp;#10084; by &lt;a href=&quot;https://github.com&quot;&gt;GitHub&lt;/a&gt;
      &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;after adding plugins, we need to install DynamoDB local in the project folder&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;serverless dynamodb install&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;now it’s time to run our local serverless. If you see a similar output, it means your setup was successful. You have your local DynamoDB instance running at localhost:8000, your local server is running at localhost:3000 and you have one endpoint at the root.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;\&amp;gt; serverless offline start
Dynamodb Local Started, Visit: [http://localhost:8000/shell](http://localhost:8000/shell)
Serverless: Starting Offline: dev/us-east-1.

Serverless: Routes for hello:
Serverless: GET /

Serverless: Offline listening on [http://localhost:3000](http://localhost:3000)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Try hitting &lt;a href=&quot;http://localhost:3000&quot;&gt;http://localhost:3000&lt;/a&gt;, you should see the output of the lambda function.&lt;/p&gt;
&lt;h4&gt;Integrating with local DynamoDB&lt;/h4&gt;
&lt;p&gt;We need to make the following changes to our serverless.yml file.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;add an environment variable for the table name which we’ll use it in the template as well as in our nodejs code.&lt;/li&gt;
&lt;li&gt;Replace functions section with two new functions; one for getting the users from dynamo and other for creating new users.&lt;/li&gt;
&lt;li&gt;Add resources section which has the definition of our table&lt;/li&gt;
&lt;li&gt;Set some flags in custom section for our local DynamoDB. Setting migrate to true will create the tables on start.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;div id=&quot;gist90509510&quot; class=&quot;gist&quot;&gt;
    &lt;div class=&quot;gist-file&quot;&gt;
      &lt;div class=&quot;gist-data&quot;&gt;
        &lt;div class=&quot;js-gist-file-update-container js-task-list-container file-box&quot;&gt;
  &lt;div id=&quot;file-serverless-offline-02-serverless-yml&quot; class=&quot;file&quot;&gt;
    

  &lt;div itemprop=&quot;text&quot; class=&quot;Box-body p-0 blob-wrapper data type-yaml &quot;&gt;
      
&lt;table class=&quot;highlight tab-size js-file-line-container&quot; data-tab-size=&quot;8&quot;&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-L1&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;1&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-LC1&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-ent&quot;&gt;service&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;test-serverless&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-L2&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;2&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-LC2&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-ent&quot;&gt;provider&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-L3&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;3&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-LC3&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;  &lt;span class=&quot;pl-ent&quot;&gt;name&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;aws&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-L4&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;4&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-LC4&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;  &lt;span class=&quot;pl-ent&quot;&gt;runtime&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;nodejs8.10&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-L5&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;5&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-LC5&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;  &lt;span class=&quot;pl-ent&quot;&gt;stage&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;dev&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-L6&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;6&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-LC6&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;  &lt;span class=&quot;pl-ent&quot;&gt;environment&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-L7&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;7&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-LC7&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    &lt;span class=&quot;pl-ent&quot;&gt;DYNAMODB_USER_TABLE&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;${self:service}-${opt:stage, self:provider.stage}-Users&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-L8&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;8&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-LC8&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-ent&quot;&gt;functions&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-L9&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;9&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-LC9&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;  &lt;span class=&quot;pl-ent&quot;&gt;usersGet&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-L10&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;10&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-LC10&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    &lt;span class=&quot;pl-ent&quot;&gt;handler&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;handler.usersGet&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-L11&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;11&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-LC11&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    &lt;span class=&quot;pl-ent&quot;&gt;events&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-L12&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;12&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-LC12&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;      - &lt;span class=&quot;pl-ent&quot;&gt;http&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-L13&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;13&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-LC13&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;          &lt;span class=&quot;pl-ent&quot;&gt;path&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-L14&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;14&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-LC14&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;          &lt;span class=&quot;pl-ent&quot;&gt;method&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;get&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-L15&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;15&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-LC15&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;  &lt;span class=&quot;pl-ent&quot;&gt;usersCreate&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-L16&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;16&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-LC16&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    &lt;span class=&quot;pl-ent&quot;&gt;handler&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;handler.usersCreate&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-L17&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;17&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-LC17&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    &lt;span class=&quot;pl-ent&quot;&gt;events&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-L18&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;18&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-LC18&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;      - &lt;span class=&quot;pl-ent&quot;&gt;http&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-L19&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;19&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-LC19&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;          &lt;span class=&quot;pl-ent&quot;&gt;path&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;/create&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-L20&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;20&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-LC20&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;          &lt;span class=&quot;pl-ent&quot;&gt;method&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;get &lt;/span&gt;&lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;#&lt;/span&gt; setting the method to GET for testing&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-L21&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;21&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-LC21&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-ent&quot;&gt;resources&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-L22&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;22&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-LC22&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;  &lt;span class=&quot;pl-ent&quot;&gt;Resources&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-L23&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;23&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-LC23&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    &lt;span class=&quot;pl-ent&quot;&gt;UsersTable&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-L24&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;24&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-LC24&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;      &lt;span class=&quot;pl-ent&quot;&gt;Type&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;AWS::DynamoDB::Table&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-L25&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;25&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-LC25&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;      &lt;span class=&quot;pl-ent&quot;&gt;Properties&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-L26&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;26&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-LC26&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        &lt;span class=&quot;pl-ent&quot;&gt;TableName&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;${self:service}-${opt:stage, self:provider.stage}-Users&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-L27&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;27&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-LC27&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        &lt;span class=&quot;pl-ent&quot;&gt;AttributeDefinitions&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-L28&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;28&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-LC28&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;          - &lt;span class=&quot;pl-ent&quot;&gt;AttributeName&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;email&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-L29&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;29&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-LC29&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            &lt;span class=&quot;pl-ent&quot;&gt;AttributeType&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;S&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-L30&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;30&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-LC30&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        &lt;span class=&quot;pl-ent&quot;&gt;KeySchema&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-L31&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;31&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-LC31&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;          - &lt;span class=&quot;pl-ent&quot;&gt;AttributeName&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;email&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-L32&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;32&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-LC32&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            &lt;span class=&quot;pl-ent&quot;&gt;KeyType&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;HASH&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-L33&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;33&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-LC33&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        &lt;span class=&quot;pl-ent&quot;&gt;ProvisionedThroughput&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-L34&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;34&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-LC34&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;          &lt;span class=&quot;pl-ent&quot;&gt;ReadCapacityUnits&lt;/span&gt;: &lt;span class=&quot;pl-c1&quot;&gt;1&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-L35&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;35&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-LC35&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;          &lt;span class=&quot;pl-ent&quot;&gt;WriteCapacityUnits&lt;/span&gt;: &lt;span class=&quot;pl-c1&quot;&gt;1&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-L36&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;36&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-LC36&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-ent&quot;&gt;plugins&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-L37&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;37&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-LC37&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;  - &lt;span class=&quot;pl-s&quot;&gt;serverless-dynamodb-local&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-L38&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;38&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-LC38&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;  - &lt;span class=&quot;pl-s&quot;&gt;serverless-offline&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-L39&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;39&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-LC39&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-ent&quot;&gt;custom&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-L40&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;40&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-LC40&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;  &lt;span class=&quot;pl-ent&quot;&gt;dynamodb&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-L41&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;41&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-LC41&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    &lt;span class=&quot;pl-ent&quot;&gt;start&lt;/span&gt;:&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-L42&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;42&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-LC42&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;      &lt;span class=&quot;pl-ent&quot;&gt;port&lt;/span&gt;: &lt;span class=&quot;pl-c1&quot;&gt;8000&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-L43&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;43&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-LC43&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;      &lt;span class=&quot;pl-ent&quot;&gt;inMemory&lt;/span&gt;: &lt;span class=&quot;pl-c1&quot;&gt;true&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-L44&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;44&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-02-serverless-yml-LC44&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;      &lt;span class=&quot;pl-ent&quot;&gt;migrate&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;true &lt;/span&gt;&lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;#&lt;/span&gt; create tables on start&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
&lt;/table&gt;


  &lt;/div&gt;

  &lt;/div&gt;
&lt;/div&gt;

      &lt;/div&gt;
      &lt;div class=&quot;gist-meta&quot;&gt;
        &lt;a href=&quot;https://gist.github.com/merictaze/70d295e86e9006b98e22c94e12534eb7/raw/fd30d9b6e750e43710a7a05bb5044d935baa9802/serverless-offline-02-serverless.yml&quot; style=&quot;float:right&quot;&gt;view raw&lt;/a&gt;
        &lt;a href=&quot;https://gist.github.com/merictaze/70d295e86e9006b98e22c94e12534eb7#file-serverless-offline-02-serverless-yml&quot;&gt;serverless-offline-02-serverless.yml&lt;/a&gt;
        hosted with &amp;#10084; by &lt;a href=&quot;https://github.com&quot;&gt;GitHub&lt;/a&gt;
      &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;&lt;/p&gt;
&lt;h4&gt;Updating lambda functions&lt;/h4&gt;
&lt;p&gt;Let’s update our lambda functions to read/write to the table we defined above.&lt;/p&gt;
&lt;p&gt;serverless-offline plugin sets IS_OFFLINE environment variable to true. We’ll use it to decide if we want to connect to the local dynamo instance or the one in AWS. In other words, if we run serverless offline start, it will connect to the local DynamoDB, but once we deploy it to AWS, it will use the actual DynamoDB table.&lt;/p&gt;
&lt;p&gt;Then we have our lambda functions: usersGet will return all entries in the table while usersCreate will add new entries.&lt;/p&gt;
&lt;p&gt;If you’re not familiar with async/await, you can quickly check it &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function&quot;&gt;here&lt;/a&gt;. Since we changed our runtime to nodejs8.10 in serverless.yml, we can use this cool feature.&lt;/p&gt;
&lt;p&gt;&lt;div id=&quot;gist90509512&quot; class=&quot;gist&quot;&gt;
    &lt;div class=&quot;gist-file&quot;&gt;
      &lt;div class=&quot;gist-data&quot;&gt;
        &lt;div class=&quot;js-gist-file-update-container js-task-list-container file-box&quot;&gt;
  &lt;div id=&quot;file-serverless-offline-03-handler-js&quot; class=&quot;file&quot;&gt;
    

  &lt;div itemprop=&quot;text&quot; class=&quot;Box-body p-0 blob-wrapper data type-javascript &quot;&gt;
      
&lt;table class=&quot;highlight tab-size js-file-line-container&quot; data-tab-size=&quot;8&quot;&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L1&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;1&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC1&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;AWS&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;aws-sdk&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;&lt;/span&gt;);&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L2&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;2&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC2&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;bluebird&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;bluebird&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;&lt;/span&gt;);&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L3&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;3&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC3&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-c1&quot;&gt;AWS&lt;/span&gt;.&lt;span class=&quot;pl-smi&quot;&gt;config&lt;/span&gt;.&lt;span class=&quot;pl-en&quot;&gt;setPromisesDependency&lt;/span&gt;(bluebird);&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L4&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;4&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC4&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;
&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L5&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;5&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC5&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;//&lt;/span&gt; use local dynamodb if running offline&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L6&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;6&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC6&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;dbClient&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;pl-en&quot;&gt;AWS.DynamoDB.DocumentClient&lt;/span&gt;(&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L7&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;7&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC7&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;  &lt;span class=&quot;pl-c1&quot;&gt;process&lt;/span&gt;.&lt;span class=&quot;pl-smi&quot;&gt;env&lt;/span&gt;.&lt;span class=&quot;pl-c1&quot;&gt;IS_OFFLINE&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;?&lt;/span&gt; {region&lt;span class=&quot;pl-k&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;localhost&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;&lt;/span&gt;, endpoint&lt;span class=&quot;pl-k&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;http://localhost:8000&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;&lt;/span&gt;} &lt;span class=&quot;pl-k&quot;&gt;:&lt;/span&gt; {}&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L8&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;8&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC8&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;);&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L9&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;9&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC9&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;
&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L10&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;10&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC10&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-c1&quot;&gt;module&lt;/span&gt;.&lt;span class=&quot;pl-smi&quot;&gt;exports&lt;/span&gt;.&lt;span class=&quot;pl-smi&quot;&gt;usersGet&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;async&lt;/span&gt; (&lt;span class=&quot;pl-c1&quot;&gt;event&lt;/span&gt;, &lt;span class=&quot;pl-smi&quot;&gt;context&lt;/span&gt;, &lt;span class=&quot;pl-smi&quot;&gt;callback&lt;/span&gt;) &lt;span class=&quot;pl-k&quot;&gt;=&amp;gt;&lt;/span&gt; {&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L11&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;11&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC11&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;  &lt;span class=&quot;pl-k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;params&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; {&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L12&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;12&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC12&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    TableName&lt;span class=&quot;pl-k&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;process&lt;/span&gt;.&lt;span class=&quot;pl-smi&quot;&gt;env&lt;/span&gt;.&lt;span class=&quot;pl-c1&quot;&gt;DYNAMODB_USER_TABLE&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L13&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;13&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC13&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;  };&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L14&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;14&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC14&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;  &lt;span class=&quot;pl-k&quot;&gt;let&lt;/span&gt; result;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L15&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;15&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC15&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;  &lt;span class=&quot;pl-k&quot;&gt;try&lt;/span&gt; {&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L16&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;16&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC16&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    result &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;pl-smi&quot;&gt;dbClient&lt;/span&gt;.&lt;span class=&quot;pl-en&quot;&gt;scan&lt;/span&gt;(params).&lt;span class=&quot;pl-en&quot;&gt;promise&lt;/span&gt;();&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L17&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;17&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC17&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;  } &lt;span class=&quot;pl-k&quot;&gt;catch&lt;/span&gt;(error) {&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L18&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;18&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC18&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    &lt;span class=&quot;pl-en&quot;&gt;callback&lt;/span&gt;(&lt;span class=&quot;pl-c1&quot;&gt;null&lt;/span&gt;, {&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L19&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;19&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC19&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;      statusCode&lt;span class=&quot;pl-k&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pl-smi&quot;&gt;error&lt;/span&gt;.&lt;span class=&quot;pl-smi&quot;&gt;statusCode&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;501&lt;/span&gt;,&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L20&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;20&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC20&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;      headers&lt;span class=&quot;pl-k&quot;&gt;:&lt;/span&gt; { &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;Content-Type&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;pl-k&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;text/plain&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;&lt;/span&gt; },&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L21&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;21&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC21&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;      body&lt;span class=&quot;pl-k&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;Failed to get users&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L22&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;22&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC22&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    });&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L23&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;23&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC23&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    &lt;span class=&quot;pl-k&quot;&gt;return&lt;/span&gt;;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L24&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;24&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC24&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;  }&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L25&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;25&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC25&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;
&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L26&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;26&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC26&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;  &lt;span class=&quot;pl-en&quot;&gt;callback&lt;/span&gt;(&lt;span class=&quot;pl-c1&quot;&gt;null&lt;/span&gt;, {&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L27&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;27&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC27&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    statusCode&lt;span class=&quot;pl-k&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;200&lt;/span&gt;,&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L28&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;28&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC28&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    body&lt;span class=&quot;pl-k&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;JSON&lt;/span&gt;.&lt;span class=&quot;pl-c1&quot;&gt;stringify&lt;/span&gt;(&lt;span class=&quot;pl-smi&quot;&gt;result&lt;/span&gt;.&lt;span class=&quot;pl-smi&quot;&gt;Items&lt;/span&gt;)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L29&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;29&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC29&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;  });&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L30&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;30&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC30&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;};&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L31&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;31&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC31&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;
&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L32&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;32&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC32&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-c1&quot;&gt;module&lt;/span&gt;.&lt;span class=&quot;pl-smi&quot;&gt;exports&lt;/span&gt;.&lt;span class=&quot;pl-smi&quot;&gt;usersCreate&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;async&lt;/span&gt; (&lt;span class=&quot;pl-c1&quot;&gt;event&lt;/span&gt;, &lt;span class=&quot;pl-smi&quot;&gt;context&lt;/span&gt;, &lt;span class=&quot;pl-smi&quot;&gt;callback&lt;/span&gt;) &lt;span class=&quot;pl-k&quot;&gt;=&amp;gt;&lt;/span&gt; {&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L33&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;33&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC33&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;  &lt;span class=&quot;pl-k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;params&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; {&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L34&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;34&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC34&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    TableName&lt;span class=&quot;pl-k&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;process&lt;/span&gt;.&lt;span class=&quot;pl-smi&quot;&gt;env&lt;/span&gt;.&lt;span class=&quot;pl-c1&quot;&gt;DYNAMODB_USER_TABLE&lt;/span&gt;,&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L35&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;35&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC35&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    Item&lt;span class=&quot;pl-k&quot;&gt;:&lt;/span&gt; {&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L36&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;36&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC36&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;      email&lt;span class=&quot;pl-k&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;pl-s1&quot;&gt;&lt;span class=&quot;pl-pse&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;pl-c1&quot;&gt;Math&lt;/span&gt;.&lt;span class=&quot;pl-c1&quot;&gt;random&lt;/span&gt;().&lt;span class=&quot;pl-c1&quot;&gt;toString&lt;/span&gt;(&lt;span class=&quot;pl-c1&quot;&gt;36&lt;/span&gt;).&lt;span class=&quot;pl-c1&quot;&gt;substring&lt;/span&gt;(&lt;span class=&quot;pl-c1&quot;&gt;7&lt;/span&gt;)&lt;span class=&quot;pl-pse&quot;&gt;}&lt;/span&gt;&lt;/span&gt;@test.com&lt;span class=&quot;pl-pds&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L37&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;37&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC37&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    }&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L38&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;38&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC38&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;  };&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L39&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;39&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC39&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;
&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L40&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;40&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC40&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;  &lt;span class=&quot;pl-k&quot;&gt;let&lt;/span&gt; result;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L41&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;41&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC41&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;  &lt;span class=&quot;pl-k&quot;&gt;try&lt;/span&gt; {&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L42&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;42&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC42&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    result &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;pl-smi&quot;&gt;dbClient&lt;/span&gt;.&lt;span class=&quot;pl-en&quot;&gt;put&lt;/span&gt;(params).&lt;span class=&quot;pl-en&quot;&gt;promise&lt;/span&gt;();&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L43&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;43&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC43&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;  } &lt;span class=&quot;pl-k&quot;&gt;catch&lt;/span&gt; (error) {&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L44&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;44&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC44&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    &lt;span class=&quot;pl-en&quot;&gt;callback&lt;/span&gt;(&lt;span class=&quot;pl-c1&quot;&gt;null&lt;/span&gt;, {&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L45&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;45&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC45&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;      statusCode&lt;span class=&quot;pl-k&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pl-smi&quot;&gt;error&lt;/span&gt;.&lt;span class=&quot;pl-smi&quot;&gt;statusCode&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;501&lt;/span&gt;,&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L46&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;46&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC46&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;      headers&lt;span class=&quot;pl-k&quot;&gt;:&lt;/span&gt; {&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;Content-Type&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;pl-k&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;text/plain&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;&lt;/span&gt;},&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L47&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;47&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC47&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;      body&lt;span class=&quot;pl-k&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;Failed to create user&lt;span class=&quot;pl-pds&quot;&gt;&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L48&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;48&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC48&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    });&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L49&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;49&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC49&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    &lt;span class=&quot;pl-k&quot;&gt;return&lt;/span&gt;;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L50&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;50&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC50&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;  }&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L51&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;51&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC51&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;
&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L52&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;52&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC52&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;  &lt;span class=&quot;pl-en&quot;&gt;callback&lt;/span&gt;(&lt;span class=&quot;pl-c1&quot;&gt;null&lt;/span&gt;, {&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L53&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;53&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC53&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    statusCode&lt;span class=&quot;pl-k&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;200&lt;/span&gt;,&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L54&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;54&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC54&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    body&lt;span class=&quot;pl-k&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;JSON&lt;/span&gt;.&lt;span class=&quot;pl-c1&quot;&gt;stringify&lt;/span&gt;(&lt;span class=&quot;pl-smi&quot;&gt;params&lt;/span&gt;.&lt;span class=&quot;pl-smi&quot;&gt;Item&lt;/span&gt;)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L55&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;55&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC55&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;  });&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L56&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;56&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC56&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;};&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-L57&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;57&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-serverless-offline-03-handler-js-LC57&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;
&lt;/td&gt;
      &lt;/tr&gt;
&lt;/table&gt;


  &lt;/div&gt;

  &lt;/div&gt;
&lt;/div&gt;

      &lt;/div&gt;
      &lt;div class=&quot;gist-meta&quot;&gt;
        &lt;a href=&quot;https://gist.github.com/merictaze/330cfd207751f558231a3003eb0d9510/raw/aab0a4e70fda9041529e8c03253c1325d3f49e26/serverless-offline-03-handler.js&quot; style=&quot;float:right&quot;&gt;view raw&lt;/a&gt;
        &lt;a href=&quot;https://gist.github.com/merictaze/330cfd207751f558231a3003eb0d9510#file-serverless-offline-03-handler-js&quot;&gt;serverless-offline-03-handler.js&lt;/a&gt;
        hosted with &amp;#10084; by &lt;a href=&quot;https://github.com&quot;&gt;GitHub&lt;/a&gt;
      &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;It’s time to restart the offline server. This time, it should create the table and show two endpoints / and /create&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;\&amp;gt; serverless offline start
Dynamodb Local Started, Visit: [http://localhost:8000/shell](http://localhost:8000/shell)
Serverless: DynamoDB - created table test-serverless-dev-Users
Serverless: Starting Offline: dev/us-east-1.

Serverless: Routes for usersGet:
Serverless: GET /

Serverless: Routes for usersCreate:
Serverless: GET /create

Serverless: Offline listening on [http://localhost:3000](http://localhost:3000)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We’re all set. Let’s open &lt;a href=&quot;http://localhost:3000/create&quot;&gt;http://localhost:3000/create&lt;/a&gt; and refresh a couple of times to create new users. And now hit &lt;a href=&quot;http://localhost:3000/&quot;&gt;http://localhost:3000/&lt;/a&gt; and see all the create users.&lt;/p&gt;
&lt;p&gt;You can also deploy it to AWS with serverless deploy, but don’t forget to add necessary IAM roles for your lambda functions to access DynamoDB.&lt;/p&gt;</content:encoded></item></channel></rss>