{"componentChunkName":"component---src-templates-post-template-jsx","path":"/posts/going-serverless-offline/","webpackCompilationHash":"00bb2f67398babb16aa1","result":{"data":{"site":{"siteMetadata":{"title":"MericTaze.com - Blog on Software Development","subtitle":"","copyright":"© All rights reserved.","author":{"name":"Meric Taze","twitter":"#"},"disqusShortname":"","url":"https://merictaze.com"}},"markdownRemark":{"id":"d226410b-b09c-59e6-9bf1-aede7bdcefb8","html":"<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3842589b20fa127a7bfb0edae065241c/db310/cover.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 645px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 54.72868217054264%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAIBAwX/xAAUAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHbS0GBhP/EABkQAQACAwAAAAAAAAAAAAAAAAIBERASMf/aAAgBAQABBQK7U8C2Of/EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABgQAQEBAQEAAAAAAAAAAAAAAAERABIg/9oACAEBAAY/ApcvTDCeP//EABsQAQACAgMAAAAAAAAAAAAAAAEAERAhMUFR/9oACAEBAAE/IeAQhFXp3UC9UneTRqf/2gAMAwEAAgADAAAAEDAP/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAEDAQE/EKx//8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAECAQE/EI1//8QAGhABAAMBAQEAAAAAAAAAAAAAAQARITFBgf/aAAgBAQABPxBD3eNGbFxoXO8NrIhyvCKfsH32uzxKKe5MAADgE//Z'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"cover\"\n        title=\"\"\n        src=\"/static/3842589b20fa127a7bfb0edae065241c/db310/cover.jpg\"\n        srcset=\"/static/3842589b20fa127a7bfb0edae065241c/3bc27/cover.jpg 240w,\n/static/3842589b20fa127a7bfb0edae065241c/98431/cover.jpg 480w,\n/static/3842589b20fa127a7bfb0edae065241c/db310/cover.jpg 645w\"\n        sizes=\"(max-width: 645px) 100vw, 645px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>In this post, we are going to setup an environment with API Gateway, Lambda and DynamoDB using serverless framework which can be deployed to AWS directly or run fully local.</p>\n<p>What are the advantages of using offline:</p>\n<ul>\n<li>Develop stress free without unexpected fees</li>\n<li>No need to wait for the deployment to finish to test every single change.</li>\n<li>Easier local debugging.</li>\n<li>When you’re ready, it takes just one command to deploy everything to AWS</li>\n</ul>\n<p>You can also check the repositories of the individual plugins for more detailed information: <a href=\"https://github.com/serverless/serverless\">serverless</a>, <a href=\"https://github.com/dherault/serverless-offline\">serverless-offline</a> and <a href=\"https://github.com/99xt/serverless-dynamodb-local\">serverless-dynamodb-local</a>.</p>\n<h4>Setting up serverless framework</h4>\n<p>Start with installing serverless framework if you have not already</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">npm install -g serverless</code></pre></div>\n<p>and setup your AWS credentials. You can create your key and secret from AWS Console</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">sls config credentials --provider aws --key \\&lt;KEY\\&gt; --secret \\&lt;SECRET\\&gt;</code></pre></div>\n<p>We’re all set to create our serverless project</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">serverless create --template aws-nodejs --path test-serverless</code></pre></div>\n<p>This will create a serverless.yml file which contains the definition of our resources and example lambda function in handler.js</p>\n<p>At this point, you can deploy it to AWS using the below command in the project’s root folder</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">cd test-serverless\nserverless deploy</code></pre></div>\n<p>As simple as that. But we’ll continue with setting up a local development environment.</p>\n<h4>Setting up the local development environment</h4>\n<p>We need two plugins here;</p>\n<ul>\n<li>serverless-offline which emulates AWS Lambda and API Gateway</li>\n<li>serverless-dynamodb-local which runs a local DynamoDB.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">npm install serverless-offline serverless-dynamodb-local --save-dev</code></pre></div>\n<p>Next step is updating our serverless.yml file. We changed runtime to nodejs8.10 to use the latest features, added a trigger for our lambda function and also added plugins section. Note that order is important in the plugins section.</p>\n<p><div id=\"gist90509508\" class=\"gist\">\n    <div class=\"gist-file\">\n      <div class=\"gist-data\">\n        <div class=\"js-gist-file-update-container js-task-list-container file-box\">\n  <div id=\"file-serverless-offline-01-serverless-yml\" class=\"file\">\n    \n\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper data type-yaml \">\n      \n<table class=\"highlight tab-size js-file-line-container\" data-tab-size=\"8\">\n      <tr>\n        <td id=\"file-serverless-offline-01-serverless-yml-L1\" class=\"blob-num js-line-number\" data-line-number=\"1\"></td>\n        <td id=\"file-serverless-offline-01-serverless-yml-LC1\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-ent\">service</span>: <span class=\"pl-s\">test-serverless</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-01-serverless-yml-L2\" class=\"blob-num js-line-number\" data-line-number=\"2\"></td>\n        <td id=\"file-serverless-offline-01-serverless-yml-LC2\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-ent\">provider</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-01-serverless-yml-L3\" class=\"blob-num js-line-number\" data-line-number=\"3\"></td>\n        <td id=\"file-serverless-offline-01-serverless-yml-LC3\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-ent\">name</span>: <span class=\"pl-s\">aws</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-01-serverless-yml-L4\" class=\"blob-num js-line-number\" data-line-number=\"4\"></td>\n        <td id=\"file-serverless-offline-01-serverless-yml-LC4\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-ent\">runtime</span>: <span class=\"pl-s\">nodejs8.10</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-01-serverless-yml-L5\" class=\"blob-num js-line-number\" data-line-number=\"5\"></td>\n        <td id=\"file-serverless-offline-01-serverless-yml-LC5\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-ent\">functions</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-01-serverless-yml-L6\" class=\"blob-num js-line-number\" data-line-number=\"6\"></td>\n        <td id=\"file-serverless-offline-01-serverless-yml-LC6\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-ent\">hello</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-01-serverless-yml-L7\" class=\"blob-num js-line-number\" data-line-number=\"7\"></td>\n        <td id=\"file-serverless-offline-01-serverless-yml-LC7\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">handler</span>: <span class=\"pl-s\">handler.hello</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-01-serverless-yml-L8\" class=\"blob-num js-line-number\" data-line-number=\"8\"></td>\n        <td id=\"file-serverless-offline-01-serverless-yml-LC8\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">events</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-01-serverless-yml-L9\" class=\"blob-num js-line-number\" data-line-number=\"9\"></td>\n        <td id=\"file-serverless-offline-01-serverless-yml-LC9\" class=\"blob-code blob-code-inner js-file-line\">      - <span class=\"pl-ent\">http</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-01-serverless-yml-L10\" class=\"blob-num js-line-number\" data-line-number=\"10\"></td>\n        <td id=\"file-serverless-offline-01-serverless-yml-LC10\" class=\"blob-code blob-code-inner js-file-line\">          <span class=\"pl-ent\">path</span>: <span class=\"pl-s\"><span class=\"pl-pds\">&#39;</span><span class=\"pl-pds\">&#39;</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-01-serverless-yml-L11\" class=\"blob-num js-line-number\" data-line-number=\"11\"></td>\n        <td id=\"file-serverless-offline-01-serverless-yml-LC11\" class=\"blob-code blob-code-inner js-file-line\">          <span class=\"pl-ent\">method</span>: <span class=\"pl-s\">get</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-01-serverless-yml-L12\" class=\"blob-num js-line-number\" data-line-number=\"12\"></td>\n        <td id=\"file-serverless-offline-01-serverless-yml-LC12\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-ent\">plugins</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-01-serverless-yml-L13\" class=\"blob-num js-line-number\" data-line-number=\"13\"></td>\n        <td id=\"file-serverless-offline-01-serverless-yml-LC13\" class=\"blob-code blob-code-inner js-file-line\">  - <span class=\"pl-s\">serverless-dynamodb-local</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-01-serverless-yml-L14\" class=\"blob-num js-line-number\" data-line-number=\"14\"></td>\n        <td id=\"file-serverless-offline-01-serverless-yml-LC14\" class=\"blob-code blob-code-inner js-file-line\">  - <span class=\"pl-s\">serverless-offline</span></td>\n      </tr>\n</table>\n\n\n  </div>\n\n  </div>\n</div>\n\n      </div>\n      <div class=\"gist-meta\">\n        <a href=\"https://gist.github.com/merictaze/068004266504369680dbb58c4df2c7e3/raw/2330354254dd5eb7e5ee41ecbfceb6db57a55f34/serverless-offline-01-serverless.yml\" style=\"float:right\">view raw</a>\n        <a href=\"https://gist.github.com/merictaze/068004266504369680dbb58c4df2c7e3#file-serverless-offline-01-serverless-yml\">serverless-offline-01-serverless.yml</a>\n        hosted with &#10084; by <a href=\"https://github.com\">GitHub</a>\n      </div>\n    </div>\n</div></p>\n<p>after adding plugins, we need to install DynamoDB local in the project folder</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">serverless dynamodb install</code></pre></div>\n<p>now it’s time to run our local serverless. If you see a similar output, it means your setup was successful. You have your local DynamoDB instance running at localhost:8000, your local server is running at localhost:3000 and you have one endpoint at the root.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">\\&gt; serverless offline start\nDynamodb Local Started, Visit: [http://localhost:8000/shell](http://localhost:8000/shell)\nServerless: Starting Offline: dev/us-east-1.\n\nServerless: Routes for hello:\nServerless: GET /\n\nServerless: Offline listening on [http://localhost:3000](http://localhost:3000)</code></pre></div>\n<p>Try hitting <a href=\"http://localhost:3000\">http://localhost:3000</a>, you should see the output of the lambda function.</p>\n<h4>Integrating with local DynamoDB</h4>\n<p>We need to make the following changes to our serverless.yml file.</p>\n<ol>\n<li>add an environment variable for the table name which we’ll use it in the template as well as in our nodejs code.</li>\n<li>Replace functions section with two new functions; one for getting the users from dynamo and other for creating new users.</li>\n<li>Add resources section which has the definition of our table</li>\n<li>Set some flags in custom section for our local DynamoDB. Setting migrate to true will create the tables on start.</li>\n</ol>\n<p><div id=\"gist90509510\" class=\"gist\">\n    <div class=\"gist-file\">\n      <div class=\"gist-data\">\n        <div class=\"js-gist-file-update-container js-task-list-container file-box\">\n  <div id=\"file-serverless-offline-02-serverless-yml\" class=\"file\">\n    \n\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper data type-yaml \">\n      \n<table class=\"highlight tab-size js-file-line-container\" data-tab-size=\"8\">\n      <tr>\n        <td id=\"file-serverless-offline-02-serverless-yml-L1\" class=\"blob-num js-line-number\" data-line-number=\"1\"></td>\n        <td id=\"file-serverless-offline-02-serverless-yml-LC1\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-ent\">service</span>: <span class=\"pl-s\">test-serverless</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-02-serverless-yml-L2\" class=\"blob-num js-line-number\" data-line-number=\"2\"></td>\n        <td id=\"file-serverless-offline-02-serverless-yml-LC2\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-ent\">provider</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-02-serverless-yml-L3\" class=\"blob-num js-line-number\" data-line-number=\"3\"></td>\n        <td id=\"file-serverless-offline-02-serverless-yml-LC3\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-ent\">name</span>: <span class=\"pl-s\">aws</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-02-serverless-yml-L4\" class=\"blob-num js-line-number\" data-line-number=\"4\"></td>\n        <td id=\"file-serverless-offline-02-serverless-yml-LC4\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-ent\">runtime</span>: <span class=\"pl-s\">nodejs8.10</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-02-serverless-yml-L5\" class=\"blob-num js-line-number\" data-line-number=\"5\"></td>\n        <td id=\"file-serverless-offline-02-serverless-yml-LC5\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-ent\">stage</span>: <span class=\"pl-s\">dev</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-02-serverless-yml-L6\" class=\"blob-num js-line-number\" data-line-number=\"6\"></td>\n        <td id=\"file-serverless-offline-02-serverless-yml-LC6\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-ent\">environment</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-02-serverless-yml-L7\" class=\"blob-num js-line-number\" data-line-number=\"7\"></td>\n        <td id=\"file-serverless-offline-02-serverless-yml-LC7\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">DYNAMODB_USER_TABLE</span>: <span class=\"pl-s\">${self:service}-${opt:stage, self:provider.stage}-Users</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-02-serverless-yml-L8\" class=\"blob-num js-line-number\" data-line-number=\"8\"></td>\n        <td id=\"file-serverless-offline-02-serverless-yml-LC8\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-ent\">functions</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-02-serverless-yml-L9\" class=\"blob-num js-line-number\" data-line-number=\"9\"></td>\n        <td id=\"file-serverless-offline-02-serverless-yml-LC9\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-ent\">usersGet</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-02-serverless-yml-L10\" class=\"blob-num js-line-number\" data-line-number=\"10\"></td>\n        <td id=\"file-serverless-offline-02-serverless-yml-LC10\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">handler</span>: <span class=\"pl-s\">handler.usersGet</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-02-serverless-yml-L11\" class=\"blob-num js-line-number\" data-line-number=\"11\"></td>\n        <td id=\"file-serverless-offline-02-serverless-yml-LC11\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">events</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-02-serverless-yml-L12\" class=\"blob-num js-line-number\" data-line-number=\"12\"></td>\n        <td id=\"file-serverless-offline-02-serverless-yml-LC12\" class=\"blob-code blob-code-inner js-file-line\">      - <span class=\"pl-ent\">http</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-02-serverless-yml-L13\" class=\"blob-num js-line-number\" data-line-number=\"13\"></td>\n        <td id=\"file-serverless-offline-02-serverless-yml-LC13\" class=\"blob-code blob-code-inner js-file-line\">          <span class=\"pl-ent\">path</span>: <span class=\"pl-s\"><span class=\"pl-pds\">&#39;</span><span class=\"pl-pds\">&#39;</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-02-serverless-yml-L14\" class=\"blob-num js-line-number\" data-line-number=\"14\"></td>\n        <td id=\"file-serverless-offline-02-serverless-yml-LC14\" class=\"blob-code blob-code-inner js-file-line\">          <span class=\"pl-ent\">method</span>: <span class=\"pl-s\">get</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-02-serverless-yml-L15\" class=\"blob-num js-line-number\" data-line-number=\"15\"></td>\n        <td id=\"file-serverless-offline-02-serverless-yml-LC15\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-ent\">usersCreate</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-02-serverless-yml-L16\" class=\"blob-num js-line-number\" data-line-number=\"16\"></td>\n        <td id=\"file-serverless-offline-02-serverless-yml-LC16\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">handler</span>: <span class=\"pl-s\">handler.usersCreate</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-02-serverless-yml-L17\" class=\"blob-num js-line-number\" data-line-number=\"17\"></td>\n        <td id=\"file-serverless-offline-02-serverless-yml-LC17\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">events</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-02-serverless-yml-L18\" class=\"blob-num js-line-number\" data-line-number=\"18\"></td>\n        <td id=\"file-serverless-offline-02-serverless-yml-LC18\" class=\"blob-code blob-code-inner js-file-line\">      - <span class=\"pl-ent\">http</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-02-serverless-yml-L19\" class=\"blob-num js-line-number\" data-line-number=\"19\"></td>\n        <td id=\"file-serverless-offline-02-serverless-yml-LC19\" class=\"blob-code blob-code-inner js-file-line\">          <span class=\"pl-ent\">path</span>: <span class=\"pl-s\"><span class=\"pl-pds\">&#39;</span>/create<span class=\"pl-pds\">&#39;</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-02-serverless-yml-L20\" class=\"blob-num js-line-number\" data-line-number=\"20\"></td>\n        <td id=\"file-serverless-offline-02-serverless-yml-LC20\" class=\"blob-code blob-code-inner js-file-line\">          <span class=\"pl-ent\">method</span>: <span class=\"pl-s\">get </span><span class=\"pl-c\"><span class=\"pl-c\">#</span> setting the method to GET for testing</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-02-serverless-yml-L21\" class=\"blob-num js-line-number\" data-line-number=\"21\"></td>\n        <td id=\"file-serverless-offline-02-serverless-yml-LC21\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-ent\">resources</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-02-serverless-yml-L22\" class=\"blob-num js-line-number\" data-line-number=\"22\"></td>\n        <td id=\"file-serverless-offline-02-serverless-yml-LC22\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-ent\">Resources</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-02-serverless-yml-L23\" class=\"blob-num js-line-number\" data-line-number=\"23\"></td>\n        <td id=\"file-serverless-offline-02-serverless-yml-LC23\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">UsersTable</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-02-serverless-yml-L24\" class=\"blob-num js-line-number\" data-line-number=\"24\"></td>\n        <td id=\"file-serverless-offline-02-serverless-yml-LC24\" class=\"blob-code blob-code-inner js-file-line\">      <span class=\"pl-ent\">Type</span>: <span class=\"pl-s\">AWS::DynamoDB::Table</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-02-serverless-yml-L25\" class=\"blob-num js-line-number\" data-line-number=\"25\"></td>\n        <td id=\"file-serverless-offline-02-serverless-yml-LC25\" class=\"blob-code blob-code-inner js-file-line\">      <span class=\"pl-ent\">Properties</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-02-serverless-yml-L26\" class=\"blob-num js-line-number\" data-line-number=\"26\"></td>\n        <td id=\"file-serverless-offline-02-serverless-yml-LC26\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-ent\">TableName</span>: <span class=\"pl-s\">${self:service}-${opt:stage, self:provider.stage}-Users</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-02-serverless-yml-L27\" class=\"blob-num js-line-number\" data-line-number=\"27\"></td>\n        <td id=\"file-serverless-offline-02-serverless-yml-LC27\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-ent\">AttributeDefinitions</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-02-serverless-yml-L28\" class=\"blob-num js-line-number\" data-line-number=\"28\"></td>\n        <td id=\"file-serverless-offline-02-serverless-yml-LC28\" class=\"blob-code blob-code-inner js-file-line\">          - <span class=\"pl-ent\">AttributeName</span>: <span class=\"pl-s\">email</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-02-serverless-yml-L29\" class=\"blob-num js-line-number\" data-line-number=\"29\"></td>\n        <td id=\"file-serverless-offline-02-serverless-yml-LC29\" class=\"blob-code blob-code-inner js-file-line\">            <span class=\"pl-ent\">AttributeType</span>: <span class=\"pl-s\">S</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-02-serverless-yml-L30\" class=\"blob-num js-line-number\" data-line-number=\"30\"></td>\n        <td id=\"file-serverless-offline-02-serverless-yml-LC30\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-ent\">KeySchema</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-02-serverless-yml-L31\" class=\"blob-num js-line-number\" data-line-number=\"31\"></td>\n        <td id=\"file-serverless-offline-02-serverless-yml-LC31\" class=\"blob-code blob-code-inner js-file-line\">          - <span class=\"pl-ent\">AttributeName</span>: <span class=\"pl-s\">email</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-02-serverless-yml-L32\" class=\"blob-num js-line-number\" data-line-number=\"32\"></td>\n        <td id=\"file-serverless-offline-02-serverless-yml-LC32\" class=\"blob-code blob-code-inner js-file-line\">            <span class=\"pl-ent\">KeyType</span>: <span class=\"pl-s\">HASH</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-02-serverless-yml-L33\" class=\"blob-num js-line-number\" data-line-number=\"33\"></td>\n        <td id=\"file-serverless-offline-02-serverless-yml-LC33\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-ent\">ProvisionedThroughput</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-02-serverless-yml-L34\" class=\"blob-num js-line-number\" data-line-number=\"34\"></td>\n        <td id=\"file-serverless-offline-02-serverless-yml-LC34\" class=\"blob-code blob-code-inner js-file-line\">          <span class=\"pl-ent\">ReadCapacityUnits</span>: <span class=\"pl-c1\">1</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-02-serverless-yml-L35\" class=\"blob-num js-line-number\" data-line-number=\"35\"></td>\n        <td id=\"file-serverless-offline-02-serverless-yml-LC35\" class=\"blob-code blob-code-inner js-file-line\">          <span class=\"pl-ent\">WriteCapacityUnits</span>: <span class=\"pl-c1\">1</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-02-serverless-yml-L36\" class=\"blob-num js-line-number\" data-line-number=\"36\"></td>\n        <td id=\"file-serverless-offline-02-serverless-yml-LC36\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-ent\">plugins</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-02-serverless-yml-L37\" class=\"blob-num js-line-number\" data-line-number=\"37\"></td>\n        <td id=\"file-serverless-offline-02-serverless-yml-LC37\" class=\"blob-code blob-code-inner js-file-line\">  - <span class=\"pl-s\">serverless-dynamodb-local</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-02-serverless-yml-L38\" class=\"blob-num js-line-number\" data-line-number=\"38\"></td>\n        <td id=\"file-serverless-offline-02-serverless-yml-LC38\" class=\"blob-code blob-code-inner js-file-line\">  - <span class=\"pl-s\">serverless-offline</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-02-serverless-yml-L39\" class=\"blob-num js-line-number\" data-line-number=\"39\"></td>\n        <td id=\"file-serverless-offline-02-serverless-yml-LC39\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-ent\">custom</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-02-serverless-yml-L40\" class=\"blob-num js-line-number\" data-line-number=\"40\"></td>\n        <td id=\"file-serverless-offline-02-serverless-yml-LC40\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-ent\">dynamodb</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-02-serverless-yml-L41\" class=\"blob-num js-line-number\" data-line-number=\"41\"></td>\n        <td id=\"file-serverless-offline-02-serverless-yml-LC41\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">start</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-02-serverless-yml-L42\" class=\"blob-num js-line-number\" data-line-number=\"42\"></td>\n        <td id=\"file-serverless-offline-02-serverless-yml-LC42\" class=\"blob-code blob-code-inner js-file-line\">      <span class=\"pl-ent\">port</span>: <span class=\"pl-c1\">8000</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-02-serverless-yml-L43\" class=\"blob-num js-line-number\" data-line-number=\"43\"></td>\n        <td id=\"file-serverless-offline-02-serverless-yml-LC43\" class=\"blob-code blob-code-inner js-file-line\">      <span class=\"pl-ent\">inMemory</span>: <span class=\"pl-c1\">true</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-02-serverless-yml-L44\" class=\"blob-num js-line-number\" data-line-number=\"44\"></td>\n        <td id=\"file-serverless-offline-02-serverless-yml-LC44\" class=\"blob-code blob-code-inner js-file-line\">      <span class=\"pl-ent\">migrate</span>: <span class=\"pl-s\">true </span><span class=\"pl-c\"><span class=\"pl-c\">#</span> create tables on start</span></td>\n      </tr>\n</table>\n\n\n  </div>\n\n  </div>\n</div>\n\n      </div>\n      <div class=\"gist-meta\">\n        <a href=\"https://gist.github.com/merictaze/70d295e86e9006b98e22c94e12534eb7/raw/fd30d9b6e750e43710a7a05bb5044d935baa9802/serverless-offline-02-serverless.yml\" style=\"float:right\">view raw</a>\n        <a href=\"https://gist.github.com/merictaze/70d295e86e9006b98e22c94e12534eb7#file-serverless-offline-02-serverless-yml\">serverless-offline-02-serverless.yml</a>\n        hosted with &#10084; by <a href=\"https://github.com\">GitHub</a>\n      </div>\n    </div>\n</div></p>\n<h4>Updating lambda functions</h4>\n<p>Let’s update our lambda functions to read/write to the table we defined above.</p>\n<p>serverless-offline plugin sets IS_OFFLINE environment variable to true. We’ll use it to decide if we want to connect to the local dynamo instance or the one in AWS. In other words, if we run serverless offline start, it will connect to the local DynamoDB, but once we deploy it to AWS, it will use the actual DynamoDB table.</p>\n<p>Then we have our lambda functions: usersGet will return all entries in the table while usersCreate will add new entries.</p>\n<p>If you’re not familiar with async/await, you can quickly check it <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function\">here</a>. Since we changed our runtime to nodejs8.10 in serverless.yml, we can use this cool feature.</p>\n<p><div id=\"gist90509512\" class=\"gist\">\n    <div class=\"gist-file\">\n      <div class=\"gist-data\">\n        <div class=\"js-gist-file-update-container js-task-list-container file-box\">\n  <div id=\"file-serverless-offline-03-handler-js\" class=\"file\">\n    \n\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper data type-javascript \">\n      \n<table class=\"highlight tab-size js-file-line-container\" data-tab-size=\"8\">\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L1\" class=\"blob-num js-line-number\" data-line-number=\"1\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC1\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-k\">const</span> <span class=\"pl-c1\">AWS</span> <span class=\"pl-k\">=</span> <span class=\"pl-c1\">require</span>(<span class=\"pl-s\"><span class=\"pl-pds\">&#39;</span>aws-sdk<span class=\"pl-pds\">&#39;</span></span>);</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L2\" class=\"blob-num js-line-number\" data-line-number=\"2\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC2\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-k\">const</span> <span class=\"pl-c1\">bluebird</span> <span class=\"pl-k\">=</span> <span class=\"pl-c1\">require</span>(<span class=\"pl-s\"><span class=\"pl-pds\">&#39;</span>bluebird<span class=\"pl-pds\">&#39;</span></span>);</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L3\" class=\"blob-num js-line-number\" data-line-number=\"3\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC3\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c1\">AWS</span>.<span class=\"pl-smi\">config</span>.<span class=\"pl-en\">setPromisesDependency</span>(bluebird);</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L4\" class=\"blob-num js-line-number\" data-line-number=\"4\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC4\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L5\" class=\"blob-num js-line-number\" data-line-number=\"5\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC5\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\"><span class=\"pl-c\">//</span> use local dynamodb if running offline</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L6\" class=\"blob-num js-line-number\" data-line-number=\"6\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC6\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-k\">const</span> <span class=\"pl-c1\">dbClient</span> <span class=\"pl-k\">=</span> <span class=\"pl-k\">new</span> <span class=\"pl-en\">AWS.DynamoDB.DocumentClient</span>(</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L7\" class=\"blob-num js-line-number\" data-line-number=\"7\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC7\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-c1\">process</span>.<span class=\"pl-smi\">env</span>.<span class=\"pl-c1\">IS_OFFLINE</span> <span class=\"pl-k\">?</span> {region<span class=\"pl-k\">:</span> <span class=\"pl-s\"><span class=\"pl-pds\">&#39;</span>localhost<span class=\"pl-pds\">&#39;</span></span>, endpoint<span class=\"pl-k\">:</span> <span class=\"pl-s\"><span class=\"pl-pds\">&#39;</span>http://localhost:8000<span class=\"pl-pds\">&#39;</span></span>} <span class=\"pl-k\">:</span> {}</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L8\" class=\"blob-num js-line-number\" data-line-number=\"8\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC8\" class=\"blob-code blob-code-inner js-file-line\">);</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L9\" class=\"blob-num js-line-number\" data-line-number=\"9\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC9\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L10\" class=\"blob-num js-line-number\" data-line-number=\"10\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC10\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c1\">module</span>.<span class=\"pl-smi\">exports</span>.<span class=\"pl-smi\">usersGet</span> <span class=\"pl-k\">=</span> <span class=\"pl-k\">async</span> (<span class=\"pl-c1\">event</span>, <span class=\"pl-smi\">context</span>, <span class=\"pl-smi\">callback</span>) <span class=\"pl-k\">=&gt;</span> {</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L11\" class=\"blob-num js-line-number\" data-line-number=\"11\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC11\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-k\">const</span> <span class=\"pl-c1\">params</span> <span class=\"pl-k\">=</span> {</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L12\" class=\"blob-num js-line-number\" data-line-number=\"12\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC12\" class=\"blob-code blob-code-inner js-file-line\">    TableName<span class=\"pl-k\">:</span> <span class=\"pl-c1\">process</span>.<span class=\"pl-smi\">env</span>.<span class=\"pl-c1\">DYNAMODB_USER_TABLE</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L13\" class=\"blob-num js-line-number\" data-line-number=\"13\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC13\" class=\"blob-code blob-code-inner js-file-line\">  };</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L14\" class=\"blob-num js-line-number\" data-line-number=\"14\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC14\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-k\">let</span> result;</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L15\" class=\"blob-num js-line-number\" data-line-number=\"15\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC15\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-k\">try</span> {</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L16\" class=\"blob-num js-line-number\" data-line-number=\"16\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC16\" class=\"blob-code blob-code-inner js-file-line\">    result <span class=\"pl-k\">=</span> <span class=\"pl-k\">await</span> <span class=\"pl-smi\">dbClient</span>.<span class=\"pl-en\">scan</span>(params).<span class=\"pl-en\">promise</span>();</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L17\" class=\"blob-num js-line-number\" data-line-number=\"17\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC17\" class=\"blob-code blob-code-inner js-file-line\">  } <span class=\"pl-k\">catch</span>(error) {</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L18\" class=\"blob-num js-line-number\" data-line-number=\"18\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC18\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-en\">callback</span>(<span class=\"pl-c1\">null</span>, {</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L19\" class=\"blob-num js-line-number\" data-line-number=\"19\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC19\" class=\"blob-code blob-code-inner js-file-line\">      statusCode<span class=\"pl-k\">:</span> <span class=\"pl-smi\">error</span>.<span class=\"pl-smi\">statusCode</span> <span class=\"pl-k\">||</span> <span class=\"pl-c1\">501</span>,</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L20\" class=\"blob-num js-line-number\" data-line-number=\"20\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC20\" class=\"blob-code blob-code-inner js-file-line\">      headers<span class=\"pl-k\">:</span> { <span class=\"pl-s\"><span class=\"pl-pds\">&#39;</span>Content-Type<span class=\"pl-pds\">&#39;</span></span><span class=\"pl-k\">:</span> <span class=\"pl-s\"><span class=\"pl-pds\">&#39;</span>text/plain<span class=\"pl-pds\">&#39;</span></span> },</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L21\" class=\"blob-num js-line-number\" data-line-number=\"21\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC21\" class=\"blob-code blob-code-inner js-file-line\">      body<span class=\"pl-k\">:</span> <span class=\"pl-s\"><span class=\"pl-pds\">&#39;</span>Failed to get users<span class=\"pl-pds\">&#39;</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L22\" class=\"blob-num js-line-number\" data-line-number=\"22\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC22\" class=\"blob-code blob-code-inner js-file-line\">    });</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L23\" class=\"blob-num js-line-number\" data-line-number=\"23\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC23\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-k\">return</span>;</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L24\" class=\"blob-num js-line-number\" data-line-number=\"24\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC24\" class=\"blob-code blob-code-inner js-file-line\">  }</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L25\" class=\"blob-num js-line-number\" data-line-number=\"25\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC25\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L26\" class=\"blob-num js-line-number\" data-line-number=\"26\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC26\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-en\">callback</span>(<span class=\"pl-c1\">null</span>, {</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L27\" class=\"blob-num js-line-number\" data-line-number=\"27\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC27\" class=\"blob-code blob-code-inner js-file-line\">    statusCode<span class=\"pl-k\">:</span> <span class=\"pl-c1\">200</span>,</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L28\" class=\"blob-num js-line-number\" data-line-number=\"28\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC28\" class=\"blob-code blob-code-inner js-file-line\">    body<span class=\"pl-k\">:</span> <span class=\"pl-c1\">JSON</span>.<span class=\"pl-c1\">stringify</span>(<span class=\"pl-smi\">result</span>.<span class=\"pl-smi\">Items</span>)</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L29\" class=\"blob-num js-line-number\" data-line-number=\"29\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC29\" class=\"blob-code blob-code-inner js-file-line\">  });</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L30\" class=\"blob-num js-line-number\" data-line-number=\"30\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC30\" class=\"blob-code blob-code-inner js-file-line\">};</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L31\" class=\"blob-num js-line-number\" data-line-number=\"31\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC31\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L32\" class=\"blob-num js-line-number\" data-line-number=\"32\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC32\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c1\">module</span>.<span class=\"pl-smi\">exports</span>.<span class=\"pl-smi\">usersCreate</span> <span class=\"pl-k\">=</span> <span class=\"pl-k\">async</span> (<span class=\"pl-c1\">event</span>, <span class=\"pl-smi\">context</span>, <span class=\"pl-smi\">callback</span>) <span class=\"pl-k\">=&gt;</span> {</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L33\" class=\"blob-num js-line-number\" data-line-number=\"33\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC33\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-k\">const</span> <span class=\"pl-c1\">params</span> <span class=\"pl-k\">=</span> {</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L34\" class=\"blob-num js-line-number\" data-line-number=\"34\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC34\" class=\"blob-code blob-code-inner js-file-line\">    TableName<span class=\"pl-k\">:</span> <span class=\"pl-c1\">process</span>.<span class=\"pl-smi\">env</span>.<span class=\"pl-c1\">DYNAMODB_USER_TABLE</span>,</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L35\" class=\"blob-num js-line-number\" data-line-number=\"35\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC35\" class=\"blob-code blob-code-inner js-file-line\">    Item<span class=\"pl-k\">:</span> {</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L36\" class=\"blob-num js-line-number\" data-line-number=\"36\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC36\" class=\"blob-code blob-code-inner js-file-line\">      email<span class=\"pl-k\">:</span> <span class=\"pl-s\"><span class=\"pl-pds\">`</span><span class=\"pl-s1\"><span class=\"pl-pse\">${</span><span class=\"pl-c1\">Math</span>.<span class=\"pl-c1\">random</span>().<span class=\"pl-c1\">toString</span>(<span class=\"pl-c1\">36</span>).<span class=\"pl-c1\">substring</span>(<span class=\"pl-c1\">7</span>)<span class=\"pl-pse\">}</span></span>@test.com<span class=\"pl-pds\">`</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L37\" class=\"blob-num js-line-number\" data-line-number=\"37\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC37\" class=\"blob-code blob-code-inner js-file-line\">    }</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L38\" class=\"blob-num js-line-number\" data-line-number=\"38\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC38\" class=\"blob-code blob-code-inner js-file-line\">  };</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L39\" class=\"blob-num js-line-number\" data-line-number=\"39\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC39\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L40\" class=\"blob-num js-line-number\" data-line-number=\"40\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC40\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-k\">let</span> result;</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L41\" class=\"blob-num js-line-number\" data-line-number=\"41\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC41\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-k\">try</span> {</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L42\" class=\"blob-num js-line-number\" data-line-number=\"42\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC42\" class=\"blob-code blob-code-inner js-file-line\">    result <span class=\"pl-k\">=</span> <span class=\"pl-k\">await</span> <span class=\"pl-smi\">dbClient</span>.<span class=\"pl-en\">put</span>(params).<span class=\"pl-en\">promise</span>();</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L43\" class=\"blob-num js-line-number\" data-line-number=\"43\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC43\" class=\"blob-code blob-code-inner js-file-line\">  } <span class=\"pl-k\">catch</span> (error) {</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L44\" class=\"blob-num js-line-number\" data-line-number=\"44\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC44\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-en\">callback</span>(<span class=\"pl-c1\">null</span>, {</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L45\" class=\"blob-num js-line-number\" data-line-number=\"45\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC45\" class=\"blob-code blob-code-inner js-file-line\">      statusCode<span class=\"pl-k\">:</span> <span class=\"pl-smi\">error</span>.<span class=\"pl-smi\">statusCode</span> <span class=\"pl-k\">||</span> <span class=\"pl-c1\">501</span>,</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L46\" class=\"blob-num js-line-number\" data-line-number=\"46\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC46\" class=\"blob-code blob-code-inner js-file-line\">      headers<span class=\"pl-k\">:</span> {<span class=\"pl-s\"><span class=\"pl-pds\">&#39;</span>Content-Type<span class=\"pl-pds\">&#39;</span></span><span class=\"pl-k\">:</span> <span class=\"pl-s\"><span class=\"pl-pds\">&#39;</span>text/plain<span class=\"pl-pds\">&#39;</span></span>},</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L47\" class=\"blob-num js-line-number\" data-line-number=\"47\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC47\" class=\"blob-code blob-code-inner js-file-line\">      body<span class=\"pl-k\">:</span> <span class=\"pl-s\"><span class=\"pl-pds\">&#39;</span>Failed to create user<span class=\"pl-pds\">&#39;</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L48\" class=\"blob-num js-line-number\" data-line-number=\"48\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC48\" class=\"blob-code blob-code-inner js-file-line\">    });</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L49\" class=\"blob-num js-line-number\" data-line-number=\"49\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC49\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-k\">return</span>;</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L50\" class=\"blob-num js-line-number\" data-line-number=\"50\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC50\" class=\"blob-code blob-code-inner js-file-line\">  }</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L51\" class=\"blob-num js-line-number\" data-line-number=\"51\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC51\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L52\" class=\"blob-num js-line-number\" data-line-number=\"52\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC52\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-en\">callback</span>(<span class=\"pl-c1\">null</span>, {</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L53\" class=\"blob-num js-line-number\" data-line-number=\"53\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC53\" class=\"blob-code blob-code-inner js-file-line\">    statusCode<span class=\"pl-k\">:</span> <span class=\"pl-c1\">200</span>,</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L54\" class=\"blob-num js-line-number\" data-line-number=\"54\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC54\" class=\"blob-code blob-code-inner js-file-line\">    body<span class=\"pl-k\">:</span> <span class=\"pl-c1\">JSON</span>.<span class=\"pl-c1\">stringify</span>(<span class=\"pl-smi\">params</span>.<span class=\"pl-smi\">Item</span>)</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L55\" class=\"blob-num js-line-number\" data-line-number=\"55\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC55\" class=\"blob-code blob-code-inner js-file-line\">  });</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L56\" class=\"blob-num js-line-number\" data-line-number=\"56\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC56\" class=\"blob-code blob-code-inner js-file-line\">};</td>\n      </tr>\n      <tr>\n        <td id=\"file-serverless-offline-03-handler-js-L57\" class=\"blob-num js-line-number\" data-line-number=\"57\"></td>\n        <td id=\"file-serverless-offline-03-handler-js-LC57\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n</table>\n\n\n  </div>\n\n  </div>\n</div>\n\n      </div>\n      <div class=\"gist-meta\">\n        <a href=\"https://gist.github.com/merictaze/330cfd207751f558231a3003eb0d9510/raw/aab0a4e70fda9041529e8c03253c1325d3f49e26/serverless-offline-03-handler.js\" style=\"float:right\">view raw</a>\n        <a href=\"https://gist.github.com/merictaze/330cfd207751f558231a3003eb0d9510#file-serverless-offline-03-handler-js\">serverless-offline-03-handler.js</a>\n        hosted with &#10084; by <a href=\"https://github.com\">GitHub</a>\n      </div>\n    </div>\n</div></p>\n<p>It’s time to restart the offline server. This time, it should create the table and show two endpoints / and /create</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">\\&gt; serverless offline start\nDynamodb Local Started, Visit: [http://localhost:8000/shell](http://localhost:8000/shell)\nServerless: DynamoDB - created table test-serverless-dev-Users\nServerless: Starting Offline: dev/us-east-1.\n\nServerless: Routes for usersGet:\nServerless: GET /\n\nServerless: Routes for usersCreate:\nServerless: GET /create\n\nServerless: Offline listening on [http://localhost:3000](http://localhost:3000)</code></pre></div>\n<p>We’re all set. Let’s open <a href=\"http://localhost:3000/create\">http://localhost:3000/create</a> and refresh a couple of times to create new users. And now hit <a href=\"http://localhost:3000/\">http://localhost:3000/</a> and see all the create users.</p>\n<p>You can also deploy it to AWS with serverless deploy, but don’t forget to add necessary IAM roles for your lambda functions to access DynamoDB.</p>","fields":{"tagSlugs":["/tags/serverless/","/tags/dynamodb/","/tags/aws/","/tags/api-gateway/"],"slug":"/posts/going-serverless-offline/"},"frontmatter":{"title":"Going Serverless Offline","tags":["serverless","dynamodb","aws","api-gateway"],"date":"2018-07-03","description":"In this post, we are going to setup an environment with API Gateway, Lambda and DynamoDB using serverless framework which can be deployed to AWS directly or run fully local.","canonical":"https://medium.com/@merictaze/going-serverless-offline-8c8ecea7c65c"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/posts/going-serverless-offline/"}}}