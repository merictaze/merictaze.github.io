{"componentChunkName":"component---src-templates-post-template-jsx","path":"/posts/indexing-dynamodb-items-to-elasticsearch-using-aws-lambda/","webpackCompilationHash":"6e3c77a790c3535cee2a","result":{"data":{"site":{"siteMetadata":{"title":"MericTaze.com - Blog on Software Development","subtitle":"","copyright":"© All rights reserved.","author":{"name":"Meric Taze","twitter":"#"},"disqusShortname":"","url":"https://merictaze.com"}},"markdownRemark":{"id":"e0d2a961-ab81-5533-8e44-684568a00c73","html":"<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8314334f2eb0b6a593e78008377cbae9/aac00/cover.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 774px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 49.6124031007752%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIBBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHtVSNFf//EABgQAAIDAAAAAAAAAAAAAAAAAAEhAhEg/9oACAEBAAEFAmJWsf/EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABoQAAICAwAAAAAAAAAAAAAAAAERACEgQVH/2gAIAQEABj8CVl75DRx//8QAGhABAQACAwAAAAAAAAAAAAAAAQARMRBBUf/aAAgBAQABPyHJsBTCxNHXsangv//aAAwDAQACAAMAAAAQaA//xAAWEQADAAAAAAAAAAAAAAAAAAABECH/2gAIAQMBAT8QEX//xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAgEBPxBn/8QAHBABAAICAwEAAAAAAAAAAAAAAQARITEQQWFx/9oACAEBAAE/ECy0zhQ6GBNnUVfxEtnHjNuNJ//Z'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"cover\"\n        title=\"\"\n        src=\"/static/8314334f2eb0b6a593e78008377cbae9/aac00/cover.jpg\"\n        srcset=\"/static/8314334f2eb0b6a593e78008377cbae9/3bc27/cover.jpg 240w,\n/static/8314334f2eb0b6a593e78008377cbae9/98431/cover.jpg 480w,\n/static/8314334f2eb0b6a593e78008377cbae9/aac00/cover.jpg 774w\"\n        sizes=\"(max-width: 774px) 100vw, 774px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>DynamoDB is Amazon’s NoSQL database which offers single-digit milliseconds latency. It is great for variety of use cases, but when you need to run complex search queries on your dataset, you quickly realise it is not designed for it.  </p>\n<p>You can try using composite primary keys, local and global secondary indexes to fulfil your needs. But as the queries get more complex, you might realise those are not enough. But don’t worry, you are not alone. Lots of people who have faced with this problem chose a similar solution; using ElasticSearch for their complex search operations while keeping the DynamoDB as the authority for the data.  </p>\n<p>Here we are going to learn how ElasticSearch can be plugged into your DynamoDB with a click of a button using CloudFormation.</p>\n<p>The same steps can be done using AWS Web Console, but I think making use of CloudFormation is better as often times you need to create the same resources for multiple stages and regions.</p>\n<h3>Creating DynamoDB Table</h3>\n<p>Let’s start with creating a DynamoDB table using CloudFormation. Here we create a table called ‘OrderTable’ whose key is orderId. It also sets read/write capacity to 5. One of the most important things here is that we also enable DynamoDB streams. Whenever an entry is created or updated, it will be streamed automatically. It will only return the new image, but you have <a href=\"https://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API_StreamSpecification.html\">other options</a> if you also need the old image or just the keys.</p>\n<p><div id=\"gist90498564\" class=\"gist\">\n    <div class=\"gist-file\">\n      <div class=\"gist-data\">\n        <div class=\"js-gist-file-update-container js-task-list-container file-box\">\n  <div id=\"file-ddb2es-01-cf-dynamo-yml\" class=\"file\">\n    \n\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper data type-yaml \">\n      \n<table class=\"highlight tab-size js-file-line-container\" data-tab-size=\"8\">\n      <tr>\n        <td id=\"file-ddb2es-01-cf-dynamo-yml-L1\" class=\"blob-num js-line-number\" data-line-number=\"1\"></td>\n        <td id=\"file-ddb2es-01-cf-dynamo-yml-LC1\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-ent\">OrderTable</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-01-cf-dynamo-yml-L2\" class=\"blob-num js-line-number\" data-line-number=\"2\"></td>\n        <td id=\"file-ddb2es-01-cf-dynamo-yml-LC2\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-ent\">Type</span>: <span class=\"pl-s\"><span class=\"pl-pds\">&#39;</span>AWS::DynamoDB::Table<span class=\"pl-pds\">&#39;</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-01-cf-dynamo-yml-L3\" class=\"blob-num js-line-number\" data-line-number=\"3\"></td>\n        <td id=\"file-ddb2es-01-cf-dynamo-yml-LC3\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-ent\">Properties</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-01-cf-dynamo-yml-L4\" class=\"blob-num js-line-number\" data-line-number=\"4\"></td>\n        <td id=\"file-ddb2es-01-cf-dynamo-yml-LC4\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">AttributeDefinitions</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-01-cf-dynamo-yml-L5\" class=\"blob-num js-line-number\" data-line-number=\"5\"></td>\n        <td id=\"file-ddb2es-01-cf-dynamo-yml-LC5\" class=\"blob-code blob-code-inner js-file-line\">      - <span class=\"pl-ent\">AttributeName</span>: <span class=\"pl-s\"><span class=\"pl-pds\">&#39;</span>orderId<span class=\"pl-pds\">&#39;</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-01-cf-dynamo-yml-L6\" class=\"blob-num js-line-number\" data-line-number=\"6\"></td>\n        <td id=\"file-ddb2es-01-cf-dynamo-yml-LC6\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-ent\">AttributeType</span>: <span class=\"pl-s\"><span class=\"pl-pds\">&#39;</span>S<span class=\"pl-pds\">&#39;</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-01-cf-dynamo-yml-L7\" class=\"blob-num js-line-number\" data-line-number=\"7\"></td>\n        <td id=\"file-ddb2es-01-cf-dynamo-yml-LC7\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">KeySchema</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-01-cf-dynamo-yml-L8\" class=\"blob-num js-line-number\" data-line-number=\"8\"></td>\n        <td id=\"file-ddb2es-01-cf-dynamo-yml-LC8\" class=\"blob-code blob-code-inner js-file-line\">      - <span class=\"pl-ent\">AttributeName</span>: <span class=\"pl-s\"><span class=\"pl-pds\">&#39;</span>orderId<span class=\"pl-pds\">&#39;</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-01-cf-dynamo-yml-L9\" class=\"blob-num js-line-number\" data-line-number=\"9\"></td>\n        <td id=\"file-ddb2es-01-cf-dynamo-yml-LC9\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-ent\">KeyType</span>: <span class=\"pl-s\"><span class=\"pl-pds\">&#39;</span>HASH<span class=\"pl-pds\">&#39;</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-01-cf-dynamo-yml-L10\" class=\"blob-num js-line-number\" data-line-number=\"10\"></td>\n        <td id=\"file-ddb2es-01-cf-dynamo-yml-LC10\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">ProvisionedThroughput</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-01-cf-dynamo-yml-L11\" class=\"blob-num js-line-number\" data-line-number=\"11\"></td>\n        <td id=\"file-ddb2es-01-cf-dynamo-yml-LC11\" class=\"blob-code blob-code-inner js-file-line\">      <span class=\"pl-ent\">ReadCapacityUnits</span>: <span class=\"pl-c1\">5</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-01-cf-dynamo-yml-L12\" class=\"blob-num js-line-number\" data-line-number=\"12\"></td>\n        <td id=\"file-ddb2es-01-cf-dynamo-yml-LC12\" class=\"blob-code blob-code-inner js-file-line\">      <span class=\"pl-ent\">WriteCapacityUnits</span>: <span class=\"pl-c1\">5</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-01-cf-dynamo-yml-L13\" class=\"blob-num js-line-number\" data-line-number=\"13\"></td>\n        <td id=\"file-ddb2es-01-cf-dynamo-yml-LC13\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">TableName</span>: <span class=\"pl-s\"><span class=\"pl-pds\">&#39;</span>OrderTable<span class=\"pl-pds\">&#39;</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-01-cf-dynamo-yml-L14\" class=\"blob-num js-line-number\" data-line-number=\"14\"></td>\n        <td id=\"file-ddb2es-01-cf-dynamo-yml-LC14\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">StreamSpecification</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-01-cf-dynamo-yml-L15\" class=\"blob-num js-line-number\" data-line-number=\"15\"></td>\n        <td id=\"file-ddb2es-01-cf-dynamo-yml-LC15\" class=\"blob-code blob-code-inner js-file-line\">      <span class=\"pl-ent\">StreamViewType</span>: <span class=\"pl-s\"><span class=\"pl-pds\">&#39;</span>NEW_IMAGE<span class=\"pl-pds\">&#39;</span></span></td>\n      </tr>\n</table>\n\n\n  </div>\n\n  </div>\n</div>\n\n      </div>\n      <div class=\"gist-meta\">\n        <a href=\"https://gist.github.com/merictaze/0ce057b395b5c3ae88e79b6da08236b6/raw/c863fe999aec90abbc2652ff73d635c72ace6fe9/ddb2es-01-cf-dynamo.yml\" style=\"float:right\">view raw</a>\n        <a href=\"https://gist.github.com/merictaze/0ce057b395b5c3ae88e79b6da08236b6#file-ddb2es-01-cf-dynamo-yml\">ddb2es-01-cf-dynamo.yml</a>\n        hosted with &#10084; by <a href=\"https://github.com\">GitHub</a>\n      </div>\n    </div>\n</div></p>\n<p>If you already have an existing table and don’t want to create a new one, you can get its SourceArn from AWS Web Console, and use it in the following sections.</p>\n<h3>Adding a Lambda function</h3>\n<p>Here we print the records coming from DynamoDB stream. We also add a Role to access various AWS resources from our lambda function which we’ll cover later. We use ZipFile which allows adding inline code to our CloudFormation template.</p>\n<p><div id=\"gist90498566\" class=\"gist\">\n    <div class=\"gist-file\">\n      <div class=\"gist-data\">\n        <div class=\"js-gist-file-update-container js-task-list-container file-box\">\n  <div id=\"file-ddb2es-02-cf-lambda-yml\" class=\"file\">\n    \n\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper data type-yaml \">\n      \n<table class=\"highlight tab-size js-file-line-container\" data-tab-size=\"8\">\n      <tr>\n        <td id=\"file-ddb2es-02-cf-lambda-yml-L1\" class=\"blob-num js-line-number\" data-line-number=\"1\"></td>\n        <td id=\"file-ddb2es-02-cf-lambda-yml-LC1\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-ent\">EsIndexerFunction</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-02-cf-lambda-yml-L2\" class=\"blob-num js-line-number\" data-line-number=\"2\"></td>\n        <td id=\"file-ddb2es-02-cf-lambda-yml-LC2\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-ent\">Type</span>: <span class=\"pl-s\"><span class=\"pl-pds\">&#39;</span>AWS::Lambda::Function<span class=\"pl-pds\">&#39;</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-02-cf-lambda-yml-L3\" class=\"blob-num js-line-number\" data-line-number=\"3\"></td>\n        <td id=\"file-ddb2es-02-cf-lambda-yml-LC3\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-ent\">Properties</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-02-cf-lambda-yml-L4\" class=\"blob-num js-line-number\" data-line-number=\"4\"></td>\n        <td id=\"file-ddb2es-02-cf-lambda-yml-LC4\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">Handler</span>: <span class=\"pl-s\"><span class=\"pl-pds\">&#39;</span>index.handler<span class=\"pl-pds\">&#39;</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-02-cf-lambda-yml-L5\" class=\"blob-num js-line-number\" data-line-number=\"5\"></td>\n        <td id=\"file-ddb2es-02-cf-lambda-yml-LC5\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">Runtime</span>: <span class=\"pl-s\">nodejs6.10</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-02-cf-lambda-yml-L6\" class=\"blob-num js-line-number\" data-line-number=\"6\"></td>\n        <td id=\"file-ddb2es-02-cf-lambda-yml-LC6\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">Role</span>: <span class=\"pl-s\">!GetAtt LambdaRole.Arn</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-02-cf-lambda-yml-L7\" class=\"blob-num js-line-number\" data-line-number=\"7\"></td>\n        <td id=\"file-ddb2es-02-cf-lambda-yml-LC7\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">Code</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-02-cf-lambda-yml-L8\" class=\"blob-num js-line-number\" data-line-number=\"8\"></td>\n        <td id=\"file-ddb2es-02-cf-lambda-yml-LC8\" class=\"blob-code blob-code-inner js-file-line\">      <span class=\"pl-ent\">ZipFile</span>: <span class=\"pl-s\">|</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-02-cf-lambda-yml-L9\" class=\"blob-num js-line-number\" data-line-number=\"9\"></td>\n        <td id=\"file-ddb2es-02-cf-lambda-yml-LC9\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-s\">        exports.handler = (event, context, callback) =&gt; {</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-02-cf-lambda-yml-L10\" class=\"blob-num js-line-number\" data-line-number=\"10\"></td>\n        <td id=\"file-ddb2es-02-cf-lambda-yml-LC10\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-s\">          event.Records.forEach(record =&gt; {</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-02-cf-lambda-yml-L11\" class=\"blob-num js-line-number\" data-line-number=\"11\"></td>\n        <td id=\"file-ddb2es-02-cf-lambda-yml-LC11\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-s\">            console.log(record);</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-02-cf-lambda-yml-L12\" class=\"blob-num js-line-number\" data-line-number=\"12\"></td>\n        <td id=\"file-ddb2es-02-cf-lambda-yml-LC12\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-s\">          });</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-02-cf-lambda-yml-L13\" class=\"blob-num js-line-number\" data-line-number=\"13\"></td>\n        <td id=\"file-ddb2es-02-cf-lambda-yml-LC13\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-s\">        }</span></td>\n      </tr>\n</table>\n\n\n  </div>\n\n  </div>\n</div>\n\n      </div>\n      <div class=\"gist-meta\">\n        <a href=\"https://gist.github.com/merictaze/0c4add0c9c275d8e726df7db47f0e498/raw/e9eeb89f8ac766db15b810786ac2d0f58d17a099/ddb2es-02-cf-lambda.yml\" style=\"float:right\">view raw</a>\n        <a href=\"https://gist.github.com/merictaze/0c4add0c9c275d8e726df7db47f0e498#file-ddb2es-02-cf-lambda-yml\">ddb2es-02-cf-lambda.yml</a>\n        hosted with &#10084; by <a href=\"https://github.com\">GitHub</a>\n      </div>\n    </div>\n</div></p>\n<h3>Mapping between the stream and lambda function</h3>\n<p>This defines the mapping between DynamoDB Stream and our Lambda function. Whenever there is something new in DynamoDB Streams, it will trigger our lambda function with those records.</p>\n<p><div id=\"gist90498567\" class=\"gist\">\n    <div class=\"gist-file\">\n      <div class=\"gist-data\">\n        <div class=\"js-gist-file-update-container js-task-list-container file-box\">\n  <div id=\"file-ddb2es-03-cf-mapping-yml\" class=\"file\">\n    \n\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper data type-yaml \">\n      \n<table class=\"highlight tab-size js-file-line-container\" data-tab-size=\"8\">\n      <tr>\n        <td id=\"file-ddb2es-03-cf-mapping-yml-L1\" class=\"blob-num js-line-number\" data-line-number=\"1\"></td>\n        <td id=\"file-ddb2es-03-cf-mapping-yml-LC1\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-ent\">TableStreamLambdaMapping</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-03-cf-mapping-yml-L2\" class=\"blob-num js-line-number\" data-line-number=\"2\"></td>\n        <td id=\"file-ddb2es-03-cf-mapping-yml-LC2\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-ent\">Type</span>: <span class=\"pl-s\"><span class=\"pl-pds\">&#39;</span>AWS::Lambda::EventSourceMapping<span class=\"pl-pds\">&#39;</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-03-cf-mapping-yml-L3\" class=\"blob-num js-line-number\" data-line-number=\"3\"></td>\n        <td id=\"file-ddb2es-03-cf-mapping-yml-LC3\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-ent\">Properties</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-03-cf-mapping-yml-L4\" class=\"blob-num js-line-number\" data-line-number=\"4\"></td>\n        <td id=\"file-ddb2es-03-cf-mapping-yml-LC4\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">BatchSize</span>: <span class=\"pl-c1\">2</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-03-cf-mapping-yml-L5\" class=\"blob-num js-line-number\" data-line-number=\"5\"></td>\n        <td id=\"file-ddb2es-03-cf-mapping-yml-LC5\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">EventSourceArn</span>: <span class=\"pl-s\">!GetAtt OrderTable.StreamArn</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-03-cf-mapping-yml-L6\" class=\"blob-num js-line-number\" data-line-number=\"6\"></td>\n        <td id=\"file-ddb2es-03-cf-mapping-yml-LC6\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">FunctionName</span>: <span class=\"pl-s\">!GetAtt EsIndexerFunction.Arn</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-03-cf-mapping-yml-L7\" class=\"blob-num js-line-number\" data-line-number=\"7\"></td>\n        <td id=\"file-ddb2es-03-cf-mapping-yml-LC7\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">StartingPosition</span>: <span class=\"pl-s\"><span class=\"pl-pds\">&#39;</span>LATEST<span class=\"pl-pds\">&#39;</span></span></td>\n      </tr>\n</table>\n\n\n  </div>\n\n  </div>\n</div>\n\n      </div>\n      <div class=\"gist-meta\">\n        <a href=\"https://gist.github.com/merictaze/aea2be7119a77d3fcecd25872fbdf0ae/raw/f7d50282afb90fe34bb9179329b55338477a1f7a/ddb2es-03-cf-mapping.yml\" style=\"float:right\">view raw</a>\n        <a href=\"https://gist.github.com/merictaze/aea2be7119a77d3fcecd25872fbdf0ae#file-ddb2es-03-cf-mapping-yml\">ddb2es-03-cf-mapping.yml</a>\n        hosted with &#10084; by <a href=\"https://github.com\">GitHub</a>\n      </div>\n    </div>\n</div></p>\n<h3>Lambda IAM role</h3>\n<p>Here we give our lambda function access for writing logs so that we can check them in CloudWatch and also access for reading DynamoDB streams.</p>\n<p><div id=\"gist90498568\" class=\"gist\">\n    <div class=\"gist-file\">\n      <div class=\"gist-data\">\n        <div class=\"js-gist-file-update-container js-task-list-container file-box\">\n  <div id=\"file-ddb2es-04-cf-lambdarole-yml\" class=\"file\">\n    \n\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper data type-yaml \">\n      \n<table class=\"highlight tab-size js-file-line-container\" data-tab-size=\"8\">\n      <tr>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-L1\" class=\"blob-num js-line-number\" data-line-number=\"1\"></td>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-LC1\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-ent\">LambdaRole</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-L2\" class=\"blob-num js-line-number\" data-line-number=\"2\"></td>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-LC2\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-ent\">Type</span>: <span class=\"pl-s\"><span class=\"pl-pds\">&#39;</span>AWS::IAM::Role<span class=\"pl-pds\">&#39;</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-L3\" class=\"blob-num js-line-number\" data-line-number=\"3\"></td>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-LC3\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-ent\">Properties</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-L4\" class=\"blob-num js-line-number\" data-line-number=\"4\"></td>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-LC4\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">AssumeRolePolicyDocument</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-L5\" class=\"blob-num js-line-number\" data-line-number=\"5\"></td>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-LC5\" class=\"blob-code blob-code-inner js-file-line\">      <span class=\"pl-ent\">Version</span>: <span class=\"pl-s\"><span class=\"pl-pds\">&#39;</span>2012-10-17<span class=\"pl-pds\">&#39;</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-L6\" class=\"blob-num js-line-number\" data-line-number=\"6\"></td>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-LC6\" class=\"blob-code blob-code-inner js-file-line\">      <span class=\"pl-ent\">Statement</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-L7\" class=\"blob-num js-line-number\" data-line-number=\"7\"></td>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-LC7\" class=\"blob-code blob-code-inner js-file-line\">      - <span class=\"pl-ent\">Effect</span>: <span class=\"pl-s\"><span class=\"pl-pds\">&#39;</span>Allow<span class=\"pl-pds\">&#39;</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-L8\" class=\"blob-num js-line-number\" data-line-number=\"8\"></td>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-LC8\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-ent\">Principal</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-L9\" class=\"blob-num js-line-number\" data-line-number=\"9\"></td>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-LC9\" class=\"blob-code blob-code-inner js-file-line\">          <span class=\"pl-ent\">Service</span>: <span class=\"pl-s\"><span class=\"pl-pds\">&#39;</span>lambda.amazonaws.com<span class=\"pl-pds\">&#39;</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-L10\" class=\"blob-num js-line-number\" data-line-number=\"10\"></td>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-LC10\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-ent\">Action</span>: <span class=\"pl-s\"><span class=\"pl-pds\">&#39;</span>sts:AssumeRole<span class=\"pl-pds\">&#39;</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-L11\" class=\"blob-num js-line-number\" data-line-number=\"11\"></td>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-LC11\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">Path</span>: <span class=\"pl-s\"><span class=\"pl-pds\">&#39;</span>/<span class=\"pl-pds\">&#39;</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-L12\" class=\"blob-num js-line-number\" data-line-number=\"12\"></td>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-LC12\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">Policies</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-L13\" class=\"blob-num js-line-number\" data-line-number=\"13\"></td>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-LC13\" class=\"blob-code blob-code-inner js-file-line\">      - <span class=\"pl-ent\">PolicyName</span>: <span class=\"pl-s\"><span class=\"pl-pds\">&#39;</span>LambdaRolePolicy<span class=\"pl-pds\">&#39;</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-L14\" class=\"blob-num js-line-number\" data-line-number=\"14\"></td>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-LC14\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-ent\">PolicyDocument</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-L15\" class=\"blob-num js-line-number\" data-line-number=\"15\"></td>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-LC15\" class=\"blob-code blob-code-inner js-file-line\">          <span class=\"pl-ent\">Version</span>: <span class=\"pl-s\"><span class=\"pl-pds\">&#39;</span>2012-10-17<span class=\"pl-pds\">&#39;</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-L16\" class=\"blob-num js-line-number\" data-line-number=\"16\"></td>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-LC16\" class=\"blob-code blob-code-inner js-file-line\">          <span class=\"pl-ent\">Statement</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-L17\" class=\"blob-num js-line-number\" data-line-number=\"17\"></td>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-LC17\" class=\"blob-code blob-code-inner js-file-line\">          - <span class=\"pl-ent\">Effect</span>: <span class=\"pl-s\"><span class=\"pl-pds\">&#39;</span>Allow<span class=\"pl-pds\">&#39;</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-L18\" class=\"blob-num js-line-number\" data-line-number=\"18\"></td>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-LC18\" class=\"blob-code blob-code-inner js-file-line\">            <span class=\"pl-ent\">Action</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-L19\" class=\"blob-num js-line-number\" data-line-number=\"19\"></td>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-LC19\" class=\"blob-code blob-code-inner js-file-line\">            - <span class=\"pl-s\">logs:CreateLogGroup</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-L20\" class=\"blob-num js-line-number\" data-line-number=\"20\"></td>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-LC20\" class=\"blob-code blob-code-inner js-file-line\">            - <span class=\"pl-s\">logs:CreateLogStream</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-L21\" class=\"blob-num js-line-number\" data-line-number=\"21\"></td>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-LC21\" class=\"blob-code blob-code-inner js-file-line\">            - <span class=\"pl-s\">logs:PutLogEvents</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-L22\" class=\"blob-num js-line-number\" data-line-number=\"22\"></td>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-LC22\" class=\"blob-code blob-code-inner js-file-line\">            <span class=\"pl-ent\">Resource</span>: <span class=\"pl-s\"><span class=\"pl-pds\">&#39;</span>arn:aws:logs:*:*:*<span class=\"pl-pds\">&#39;</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-L23\" class=\"blob-num js-line-number\" data-line-number=\"23\"></td>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-LC23\" class=\"blob-code blob-code-inner js-file-line\">          - <span class=\"pl-ent\">Effect</span>: <span class=\"pl-s\"><span class=\"pl-pds\">&#39;</span>Allow<span class=\"pl-pds\">&#39;</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-L24\" class=\"blob-num js-line-number\" data-line-number=\"24\"></td>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-LC24\" class=\"blob-code blob-code-inner js-file-line\">            <span class=\"pl-ent\">Action</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-L25\" class=\"blob-num js-line-number\" data-line-number=\"25\"></td>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-LC25\" class=\"blob-code blob-code-inner js-file-line\">            - <span class=\"pl-s\">dynamodb:DescribeStream</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-L26\" class=\"blob-num js-line-number\" data-line-number=\"26\"></td>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-LC26\" class=\"blob-code blob-code-inner js-file-line\">            - <span class=\"pl-s\">dynamodb:GetRecords</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-L27\" class=\"blob-num js-line-number\" data-line-number=\"27\"></td>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-LC27\" class=\"blob-code blob-code-inner js-file-line\">            - <span class=\"pl-s\">dynamodb:GetShardIterator</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-L28\" class=\"blob-num js-line-number\" data-line-number=\"28\"></td>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-LC28\" class=\"blob-code blob-code-inner js-file-line\">            - <span class=\"pl-s\">dynamodb:ListStreams</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-L29\" class=\"blob-num js-line-number\" data-line-number=\"29\"></td>\n        <td id=\"file-ddb2es-04-cf-lambdarole-yml-LC29\" class=\"blob-code blob-code-inner js-file-line\">            <span class=\"pl-ent\">Resource</span>: <span class=\"pl-s\">!GetAtt OrderTable.StreamArn</span></td>\n      </tr>\n</table>\n\n\n  </div>\n\n  </div>\n</div>\n\n      </div>\n      <div class=\"gist-meta\">\n        <a href=\"https://gist.github.com/merictaze/2c9bdd95e66a9226a34e61ca4f1f6a0c/raw/290eeb766b66c1b5354ebb98d1b1597a1b314506/ddb2es-04-cf-lambdarole.yml\" style=\"float:right\">view raw</a>\n        <a href=\"https://gist.github.com/merictaze/2c9bdd95e66a9226a34e61ca4f1f6a0c#file-ddb2es-04-cf-lambdarole-yml\">ddb2es-04-cf-lambdarole.yml</a>\n        hosted with &#10084; by <a href=\"https://github.com\">GitHub</a>\n      </div>\n    </div>\n</div></p>\n<h3>Adding ElasticSearch</h3>\n<p>This creates a t2.micro ElasticSearch instance which is included in Free Tier. It also allows LambdaRole to access to the instance.</p>\n<p><div id=\"gist90498571\" class=\"gist\">\n    <div class=\"gist-file\">\n      <div class=\"gist-data\">\n        <div class=\"js-gist-file-update-container js-task-list-container file-box\">\n  <div id=\"file-ddb2es-05-cf-elasticsearch-yml\" class=\"file\">\n    \n\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper data type-yaml \">\n      \n<table class=\"highlight tab-size js-file-line-container\" data-tab-size=\"8\">\n      <tr>\n        <td id=\"file-ddb2es-05-cf-elasticsearch-yml-L1\" class=\"blob-num js-line-number\" data-line-number=\"1\"></td>\n        <td id=\"file-ddb2es-05-cf-elasticsearch-yml-LC1\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-ent\">ElasticsearchDomain</span>: </td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-05-cf-elasticsearch-yml-L2\" class=\"blob-num js-line-number\" data-line-number=\"2\"></td>\n        <td id=\"file-ddb2es-05-cf-elasticsearch-yml-LC2\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-ent\">Type</span>: <span class=\"pl-s\"><span class=\"pl-pds\">&#39;</span>AWS::Elasticsearch::Domain<span class=\"pl-pds\">&#39;</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-05-cf-elasticsearch-yml-L3\" class=\"blob-num js-line-number\" data-line-number=\"3\"></td>\n        <td id=\"file-ddb2es-05-cf-elasticsearch-yml-LC3\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-ent\">Properties</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-05-cf-elasticsearch-yml-L4\" class=\"blob-num js-line-number\" data-line-number=\"4\"></td>\n        <td id=\"file-ddb2es-05-cf-elasticsearch-yml-LC4\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">DomainName</span>: <span class=\"pl-s\"><span class=\"pl-pds\">&#39;</span>es-order<span class=\"pl-pds\">&#39;</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-05-cf-elasticsearch-yml-L5\" class=\"blob-num js-line-number\" data-line-number=\"5\"></td>\n        <td id=\"file-ddb2es-05-cf-elasticsearch-yml-LC5\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">ElasticsearchClusterConfig</span>: </td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-05-cf-elasticsearch-yml-L6\" class=\"blob-num js-line-number\" data-line-number=\"6\"></td>\n        <td id=\"file-ddb2es-05-cf-elasticsearch-yml-LC6\" class=\"blob-code blob-code-inner js-file-line\">      <span class=\"pl-ent\">InstanceType</span>: <span class=\"pl-s\"><span class=\"pl-pds\">&#39;</span>t2.micro.elasticsearch<span class=\"pl-pds\">&#39;</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-05-cf-elasticsearch-yml-L7\" class=\"blob-num js-line-number\" data-line-number=\"7\"></td>\n        <td id=\"file-ddb2es-05-cf-elasticsearch-yml-LC7\" class=\"blob-code blob-code-inner js-file-line\">      <span class=\"pl-ent\">InstanceCount</span>: <span class=\"pl-c1\">1</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-05-cf-elasticsearch-yml-L8\" class=\"blob-num js-line-number\" data-line-number=\"8\"></td>\n        <td id=\"file-ddb2es-05-cf-elasticsearch-yml-LC8\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">EBSOptions</span>: </td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-05-cf-elasticsearch-yml-L9\" class=\"blob-num js-line-number\" data-line-number=\"9\"></td>\n        <td id=\"file-ddb2es-05-cf-elasticsearch-yml-LC9\" class=\"blob-code blob-code-inner js-file-line\">      <span class=\"pl-ent\">EBSEnabled</span>: <span class=\"pl-c1\">true</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-05-cf-elasticsearch-yml-L10\" class=\"blob-num js-line-number\" data-line-number=\"10\"></td>\n        <td id=\"file-ddb2es-05-cf-elasticsearch-yml-LC10\" class=\"blob-code blob-code-inner js-file-line\">      <span class=\"pl-ent\">Iops</span>: <span class=\"pl-c1\">0</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-05-cf-elasticsearch-yml-L11\" class=\"blob-num js-line-number\" data-line-number=\"11\"></td>\n        <td id=\"file-ddb2es-05-cf-elasticsearch-yml-LC11\" class=\"blob-code blob-code-inner js-file-line\">      <span class=\"pl-ent\">VolumeSize</span>: <span class=\"pl-c1\">10</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-05-cf-elasticsearch-yml-L12\" class=\"blob-num js-line-number\" data-line-number=\"12\"></td>\n        <td id=\"file-ddb2es-05-cf-elasticsearch-yml-LC12\" class=\"blob-code blob-code-inner js-file-line\">      <span class=\"pl-ent\">VolumeType</span>: <span class=\"pl-s\"><span class=\"pl-pds\">&#39;</span>standard<span class=\"pl-pds\">&#39;</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-05-cf-elasticsearch-yml-L13\" class=\"blob-num js-line-number\" data-line-number=\"13\"></td>\n        <td id=\"file-ddb2es-05-cf-elasticsearch-yml-LC13\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">AccessPolicies</span>: </td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-05-cf-elasticsearch-yml-L14\" class=\"blob-num js-line-number\" data-line-number=\"14\"></td>\n        <td id=\"file-ddb2es-05-cf-elasticsearch-yml-LC14\" class=\"blob-code blob-code-inner js-file-line\">      <span class=\"pl-ent\">Version</span>: <span class=\"pl-s\"><span class=\"pl-pds\">&#39;</span>2012-10-17<span class=\"pl-pds\">&#39;</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-05-cf-elasticsearch-yml-L15\" class=\"blob-num js-line-number\" data-line-number=\"15\"></td>\n        <td id=\"file-ddb2es-05-cf-elasticsearch-yml-LC15\" class=\"blob-code blob-code-inner js-file-line\">      <span class=\"pl-ent\">Statement</span>: </td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-05-cf-elasticsearch-yml-L16\" class=\"blob-num js-line-number\" data-line-number=\"16\"></td>\n        <td id=\"file-ddb2es-05-cf-elasticsearch-yml-LC16\" class=\"blob-code blob-code-inner js-file-line\">        - <span class=\"pl-ent\">Effect</span>: <span class=\"pl-s\"><span class=\"pl-pds\">&#39;</span>Allow<span class=\"pl-pds\">&#39;</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-05-cf-elasticsearch-yml-L17\" class=\"blob-num js-line-number\" data-line-number=\"17\"></td>\n        <td id=\"file-ddb2es-05-cf-elasticsearch-yml-LC17\" class=\"blob-code blob-code-inner js-file-line\">          <span class=\"pl-ent\">Principal</span>: </td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-05-cf-elasticsearch-yml-L18\" class=\"blob-num js-line-number\" data-line-number=\"18\"></td>\n        <td id=\"file-ddb2es-05-cf-elasticsearch-yml-LC18\" class=\"blob-code blob-code-inner js-file-line\">            <span class=\"pl-ent\">AWS</span>: <span class=\"pl-s\">!GetAtt LambdaRole.Arn</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-05-cf-elasticsearch-yml-L19\" class=\"blob-num js-line-number\" data-line-number=\"19\"></td>\n        <td id=\"file-ddb2es-05-cf-elasticsearch-yml-LC19\" class=\"blob-code blob-code-inner js-file-line\">          <span class=\"pl-ent\">Action</span>: <span class=\"pl-s\"><span class=\"pl-pds\">&#39;</span>es:*<span class=\"pl-pds\">&#39;</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-05-cf-elasticsearch-yml-L20\" class=\"blob-num js-line-number\" data-line-number=\"20\"></td>\n        <td id=\"file-ddb2es-05-cf-elasticsearch-yml-LC20\" class=\"blob-code blob-code-inner js-file-line\">          <span class=\"pl-ent\">Resource</span>: <span class=\"pl-s\"><span class=\"pl-pds\">&#39;</span>*<span class=\"pl-pds\">&#39;</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-05-cf-elasticsearch-yml-L21\" class=\"blob-num js-line-number\" data-line-number=\"21\"></td>\n        <td id=\"file-ddb2es-05-cf-elasticsearch-yml-LC21\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">AdvancedOptions</span>: </td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-05-cf-elasticsearch-yml-L22\" class=\"blob-num js-line-number\" data-line-number=\"22\"></td>\n        <td id=\"file-ddb2es-05-cf-elasticsearch-yml-LC22\" class=\"blob-code blob-code-inner js-file-line\">      <span class=\"pl-ent\">rest.action.multi.allow_explicit_index</span>: <span class=\"pl-s\"><span class=\"pl-pds\">&#39;</span>true<span class=\"pl-pds\">&#39;</span></span></td>\n      </tr>\n</table>\n\n\n  </div>\n\n  </div>\n</div>\n\n      </div>\n      <div class=\"gist-meta\">\n        <a href=\"https://gist.github.com/merictaze/0de4b21eaf7c4b03f31b700bafc03c65/raw/9eb1a23836ac5745cd5d3ed1d61f36212fa34653/ddb2es-05-cf-elasticsearch.yml\" style=\"float:right\">view raw</a>\n        <a href=\"https://gist.github.com/merictaze/0de4b21eaf7c4b03f31b700bafc03c65#file-ddb2es-05-cf-elasticsearch-yml\">ddb2es-05-cf-elasticsearch.yml</a>\n        hosted with &#10084; by <a href=\"https://github.com\">GitHub</a>\n      </div>\n    </div>\n</div></p>\n<h3>Updating Lambda to index documents</h3>\n<p>Now let’s update our previous lambda function to index DynamoDB stream records to ElasticSearch. Note that we need to sign our requests, otherwise you’ll get an authorization error.  </p>\n<p>Consider using <a href=\"https://github.com/TheDeveloper/http-aws-es\">http-aws-es</a> library which makes things quite easy if you are using S3Bucket and S3Key instead of ZipFile. It allows you to use <a href=\"https://github.com/elastic/elasticsearch-js\">elasticsearch-js</a> client and also handles the request signing part.</p>\n<p><div id=\"gist90498572\" class=\"gist\">\n    <div class=\"gist-file\">\n      <div class=\"gist-data\">\n        <div class=\"js-gist-file-update-container js-task-list-container file-box\">\n  <div id=\"file-ddb2es-06-cf-lambda_v2-yml\" class=\"file\">\n    \n\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper data type-yaml \">\n      \n<table class=\"highlight tab-size js-file-line-container\" data-tab-size=\"8\">\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L1\" class=\"blob-num js-line-number\" data-line-number=\"1\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC1\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-ent\">EsIndexerFunction</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L2\" class=\"blob-num js-line-number\" data-line-number=\"2\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC2\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">Type</span>: <span class=\"pl-s\"><span class=\"pl-pds\">&#39;</span>AWS::Lambda::Function<span class=\"pl-pds\">&#39;</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L3\" class=\"blob-num js-line-number\" data-line-number=\"3\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC3\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">Properties</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L4\" class=\"blob-num js-line-number\" data-line-number=\"4\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC4\" class=\"blob-code blob-code-inner js-file-line\">      <span class=\"pl-ent\">Handler</span>: <span class=\"pl-s\"><span class=\"pl-pds\">&#39;</span>index.handler<span class=\"pl-pds\">&#39;</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L5\" class=\"blob-num js-line-number\" data-line-number=\"5\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC5\" class=\"blob-code blob-code-inner js-file-line\">      <span class=\"pl-ent\">Runtime</span>: <span class=\"pl-s\">nodejs6.10</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L6\" class=\"blob-num js-line-number\" data-line-number=\"6\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC6\" class=\"blob-code blob-code-inner js-file-line\">      <span class=\"pl-ent\">Role</span>: <span class=\"pl-s\">!GetAtt LambdaRole.Arn</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L7\" class=\"blob-num js-line-number\" data-line-number=\"7\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC7\" class=\"blob-code blob-code-inner js-file-line\">      <span class=\"pl-ent\">Environment</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L8\" class=\"blob-num js-line-number\" data-line-number=\"8\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC8\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-ent\">Variables</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L9\" class=\"blob-num js-line-number\" data-line-number=\"9\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC9\" class=\"blob-code blob-code-inner js-file-line\">          <span class=\"pl-ent\">ES_ENDPOINT</span>: <span class=\"pl-s\">!GetAtt ElasticsearchDomain.DomainEndpoint</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L10\" class=\"blob-num js-line-number\" data-line-number=\"10\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC10\" class=\"blob-code blob-code-inner js-file-line\">          <span class=\"pl-ent\">ES_REGION</span>: <span class=\"pl-s\">!Ref AWS::Region</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L11\" class=\"blob-num js-line-number\" data-line-number=\"11\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC11\" class=\"blob-code blob-code-inner js-file-line\">      <span class=\"pl-ent\">Code</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L12\" class=\"blob-num js-line-number\" data-line-number=\"12\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC12\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-ent\">ZipFile</span>: <span class=\"pl-s\">|</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L13\" class=\"blob-num js-line-number\" data-line-number=\"13\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC13\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-s\">          var AWS = require(&#39;aws-sdk&#39;);</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L14\" class=\"blob-num js-line-number\" data-line-number=\"14\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC14\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-s\">          var path = require(&#39;path&#39;);</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L15\" class=\"blob-num js-line-number\" data-line-number=\"15\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC15\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-s\">          var creds = new AWS.EnvironmentCredentials(&#39;AWS&#39;);</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L16\" class=\"blob-num js-line-number\" data-line-number=\"16\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC16\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-s\"></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L17\" class=\"blob-num js-line-number\" data-line-number=\"17\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC17\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-s\">          var esDomain = {</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L18\" class=\"blob-num js-line-number\" data-line-number=\"18\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC18\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-s\">              endpoint: process.env.ES_ENDPOINT,</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L19\" class=\"blob-num js-line-number\" data-line-number=\"19\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC19\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-s\">              region: process.env.ES_REGION,</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L20\" class=\"blob-num js-line-number\" data-line-number=\"20\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC20\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-s\">              index: &#39;test&#39;,</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L21\" class=\"blob-num js-line-number\" data-line-number=\"21\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC21\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-s\">              doctype: &#39;order&#39;</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L22\" class=\"blob-num js-line-number\" data-line-number=\"22\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC22\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-s\">          };</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L23\" class=\"blob-num js-line-number\" data-line-number=\"23\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC23\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-s\">          var endpoint =  new AWS.Endpoint(esDomain.endpoint);</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L24\" class=\"blob-num js-line-number\" data-line-number=\"24\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC24\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-s\"></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L25\" class=\"blob-num js-line-number\" data-line-number=\"25\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC25\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-s\">          exports.handler = (event, context, callback) =&gt; {</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L26\" class=\"blob-num js-line-number\" data-line-number=\"26\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC26\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-s\">            event.Records.forEach(record =&gt; {</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L27\" class=\"blob-num js-line-number\" data-line-number=\"27\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC27\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-s\">              postDocumentToES(record.dynamodb.NewImage, context);</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L28\" class=\"blob-num js-line-number\" data-line-number=\"28\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC28\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-s\">            });</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L29\" class=\"blob-num js-line-number\" data-line-number=\"29\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC29\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-s\">          }</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L30\" class=\"blob-num js-line-number\" data-line-number=\"30\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC30\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-s\"></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L31\" class=\"blob-num js-line-number\" data-line-number=\"31\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC31\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-s\">          function postDocumentToES(doc, context) {</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L32\" class=\"blob-num js-line-number\" data-line-number=\"32\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC32\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-s\">              var req = new AWS.HttpRequest(endpoint);</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L33\" class=\"blob-num js-line-number\" data-line-number=\"33\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC33\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-s\"></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L34\" class=\"blob-num js-line-number\" data-line-number=\"34\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC34\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-s\">              req.method = &#39;POST&#39;;</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L35\" class=\"blob-num js-line-number\" data-line-number=\"35\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC35\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-s\">              req.path = path.join(&#39;/&#39;, esDomain.index, esDomain.doctype);</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L36\" class=\"blob-num js-line-number\" data-line-number=\"36\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC36\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-s\">              req.region = esDomain.region;</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L37\" class=\"blob-num js-line-number\" data-line-number=\"37\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC37\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-s\">              req.body = JSON.stringify(doc);</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L38\" class=\"blob-num js-line-number\" data-line-number=\"38\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC38\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-s\">              req.headers[&#39;presigned-expires&#39;] = false;</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L39\" class=\"blob-num js-line-number\" data-line-number=\"39\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC39\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-s\">              req.headers[&#39;Host&#39;] = endpoint.host;</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L40\" class=\"blob-num js-line-number\" data-line-number=\"40\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC40\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-s\"></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L41\" class=\"blob-num js-line-number\" data-line-number=\"41\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC41\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-s\">              // Sign the request (Sigv4)</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L42\" class=\"blob-num js-line-number\" data-line-number=\"42\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC42\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-s\">              var signer = new AWS.Signers.V4(req, &#39;es&#39;);</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L43\" class=\"blob-num js-line-number\" data-line-number=\"43\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC43\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-s\">              signer.addAuthorization(creds, new Date());</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L44\" class=\"blob-num js-line-number\" data-line-number=\"44\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC44\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-s\"></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L45\" class=\"blob-num js-line-number\" data-line-number=\"45\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC45\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-s\">              // Post document to ES</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L46\" class=\"blob-num js-line-number\" data-line-number=\"46\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC46\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-s\">              var send = new AWS.NodeHttpClient();</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L47\" class=\"blob-num js-line-number\" data-line-number=\"47\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC47\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-s\">              send.handleRequest(req, null, function(httpResp) {</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L48\" class=\"blob-num js-line-number\" data-line-number=\"48\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC48\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-s\">                  var body = &#39;&#39;;</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L49\" class=\"blob-num js-line-number\" data-line-number=\"49\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC49\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-s\">                  httpResp.on(&#39;data&#39;, chunk =&gt; body += chunk);</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L50\" class=\"blob-num js-line-number\" data-line-number=\"50\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC50\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-s\">                  httpResp.on(&#39;end&#39;, chunk =&gt; context.succeed());</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L51\" class=\"blob-num js-line-number\" data-line-number=\"51\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC51\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-s\">              }, function(err) {</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L52\" class=\"blob-num js-line-number\" data-line-number=\"52\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC52\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-s\">                  console.log(&#39;Error: &#39; + err);</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L53\" class=\"blob-num js-line-number\" data-line-number=\"53\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC53\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-s\">                  context.fail();</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L54\" class=\"blob-num js-line-number\" data-line-number=\"54\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC54\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-s\">              });</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-L55\" class=\"blob-num js-line-number\" data-line-number=\"55\"></td>\n        <td id=\"file-ddb2es-06-cf-lambda_v2-yml-LC55\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-s\">          }</span></td>\n      </tr>\n</table>\n\n\n  </div>\n\n  </div>\n</div>\n\n      </div>\n      <div class=\"gist-meta\">\n        <a href=\"https://gist.github.com/merictaze/0f3a80a2e5c069e2dcbf8a321d7d659d/raw/b866449382128db5fa6949ec9ff993a4add0b0de/ddb2es-06-cf-lambda_v2.yml\" style=\"float:right\">view raw</a>\n        <a href=\"https://gist.github.com/merictaze/0f3a80a2e5c069e2dcbf8a321d7d659d#file-ddb2es-06-cf-lambda_v2-yml\">ddb2es-06-cf-lambda_v2.yml</a>\n        hosted with &#10084; by <a href=\"https://github.com\">GitHub</a>\n      </div>\n    </div>\n</div></p>\n<p>So at this point we have everything we need. All the new DynamoDB data is being indexed to ElasticSearch behind the scenes.  </p>\n<p>You can also see the full CloudFormation template <a href=\"https://gist.github.com/merictaze/44cb99335300fb1121512eb9beea3ab3\">here</a></p>\n<p>Feel free to comment below if you have any questions or feedback.</p>","fields":{"tagSlugs":["/tags/lambda/","/tags/aws/","/tags/elasticsearch/","/tags/cloudformation/"],"slug":"/posts/indexing-dynamodb-items-to-elasticsearch-using-aws-lambda/"},"frontmatter":{"title":"Indexing DynamoDB Items to ElasticSearch using AWS Lambda","tags":["lambda","aws","elasticsearch","cloudformation"],"date":"2018-07-04","description":"DynamoDB is Amazon’s NoSQL database which offers single-digit milliseconds latency. It is great for variety of use cases, but when you need to run complex search queries on your dataset, you quickly realise it is not designed for it.","canonical":"https://medium.com/@merictaze/indexing-dynamodb-items-to-elasticsearch-using-aws-lambda-7f93f5db6277"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/posts/indexing-dynamodb-items-to-elasticsearch-using-aws-lambda/"}}}